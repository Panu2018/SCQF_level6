(function(g){var window=this;'use strict';var t_K=function(p){var l=new g.pO("und",new g.qV("Default","und",!0));l.captionTracks=p.captionTracks;return l},E0K=function(p){return new g.hl(function(l,Q){var H=p.length,q=[];
if(H)for(var W=function(F,r){H--;q[F]=r;H==0&&l(q)},c=function(F){Q(F)},E,R=0;R<p.length;R++)E=p[R],g.xc$(E,g.G$(W,R),c);
else l(q)})},L0=function(p){this.B=p},oP=function(){L0.apply(this,arguments)},R08=function(){oP.apply(this,arguments)},F8t=function(){oP.apply(this,arguments)},r6b=function(){oP.apply(this,arguments)},dOo=function(){oP.apply(this,arguments)},jG$=function(){oP.apply(this,arguments)},M_b=function(){oP.apply(this,arguments)},TB8=function(){L0.apply(this,arguments)},e0Y=function(){oP.apply(this,arguments)},z08=function(){oP.apply(this,arguments)},ZbK=function(){oP.apply(this,arguments)},BBG=function(){oP.apply(this,
arguments)},Y9o=function(){oP.apply(this,arguments)},h0$=function(){oP.apply(this,arguments)},a8C=function(){oP.apply(this,arguments)},I8o=function(){oP.apply(this,arguments)},DO8=function(){oP.apply(this,arguments)},n08=function(){oP.apply(this,arguments)},Xao=function(){oP.apply(this,arguments)},wao=function(){oP.apply(this,arguments)},S9U=function(){L0.apply(this,arguments)},NBK=function(){oP.apply(this,arguments)},V_C=function(){oP.apply(this,arguments)},kIG=function(){oP.apply(this,arguments)},
ucY=function(){oP.apply(this,arguments)},K8b=function(){oP.apply(this,arguments)},y6$=function(){oP.apply(this,arguments)},L8C=function(){oP.apply(this,arguments)},o0S=function(){oP.apply(this,arguments)},A6o=function(){oP.apply(this,arguments)},J6J=function(){L0.apply(this,arguments)},f8Y=function(){L0.apply(this,arguments)},g0K=function(){L0.apply(this,arguments)},sGS=function(){oP.apply(this,arguments)},bb$=function(){oP.apply(this,arguments)},Pho=function(){oP.apply(this,arguments)},xOS=function(){oP.apply(this,
arguments)},UOS=function(){oP.apply(this,arguments)},Ch5=function(){oP.apply(this,arguments)},Ob5=function(){oP.apply(this,arguments)},v05=function(){oP.apply(this,arguments)},mOG=function(){oP.apply(this,arguments)},GIY=function(){oP.apply(this,arguments)},i6K=function(){oP.apply(this,arguments)},pLo=function(){oP.apply(this,arguments)},lsG=function(){oP.apply(this,arguments)},Q4J=function(){oP.apply(this,arguments)},$xK=function(){oP.apply(this,arguments)},H6G=function(){oP.apply(this,arguments)},
qdY=function(){oP.apply(this,arguments)},W2b=function(){oP.apply(this,arguments)},crK=function(){oP.apply(this,arguments)},trY=function(){oP.apply(this,arguments)},EW$=function(){oP.apply(this,arguments)},RAo=function(){oP.apply(this,arguments)},F2$=function(){oP.apply(this,arguments)},rr$=function(){oP.apply(this,arguments)},dx8=function(){oP.apply(this,arguments)},j4$=function(){oP.apply(this,arguments)},Mr8=function(){L0.apply(this,arguments)},Tkb=function(){oP.apply(this,arguments)},eA$=function(){oP.apply(this,
arguments)},zAC=function(){oP.apply(this,arguments)},Z6o=function(){oP.apply(this,arguments)},Bkb=function(){oP.apply(this,arguments)},Ydb=function(){oP.apply(this,arguments)},hA8=function(){oP.apply(this,arguments)},as$=function(){oP.apply(this,arguments)},IsJ=function(){oP.apply(this,arguments)},Dxo=function(){oP.apply(this,arguments)},nWC=function(){oP.apply(this,arguments)},XLo=function(){oP.apply(this,arguments)},wLt=function(){oP.apply(this,arguments)},SdJ=function(){oP.apply(this,arguments)},
Nko=function(){oP.apply(this,arguments)},Vro=function(){oP.apply(this,arguments)},kX$=function(){oP.apply(this,arguments)},uat=function(){oP.apply(this,arguments)},K2t=function(){oP.apply(this,arguments)},yrK=function(){oP.apply(this,arguments)},L2Y=function(){oP.apply(this,arguments)},oWC=function(){oP.apply(this,arguments)},ArU=function(){oP.apply(this,arguments)},Jrb=function(){oP.apply(this,arguments)},fsb=function(){oP.apply(this,arguments)},gWG=function(){oP.apply(this,arguments)},s4G=function(){oP.apply(this,
arguments)},b6$=function(){oP.apply(this,arguments)},Pn5=function(){oP.apply(this,arguments)},xxo=function(){oP.apply(this,arguments)},Uxo=function(){oP.apply(this,arguments)},Cn8=function(){oP.apply(this,arguments)},O68=function(p){p=p.key||p.id;
if(!p)throw Error("Entity key is missing");return p},vW5=function(){if(Ax)return Ax();
var p={};Ax=g.Gy("PersistentEntityStoreDb",{I7:(p.EntityStore={Vk:1},p.EntityAssociationStore={Vk:2},p),shared:!1,upgrade:function(l,Q){Q(1)&&g.u5(g.XD(l,"EntityStore",{keyPath:"key"}),"entityType","entityType");Q(2)&&(l=g.XD(l,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.u5(l,"byParentEntityKey","parentEntityKey"),g.u5(l,"byChildEntityKey","childEntityKey"))},
version:3});return Ax()},mxo=function(p){return g.gg(vW5(),p)},GXt=function(p){return g.gg((0,g.ANY)(),p)},Jx=function(p){this.token=p},f0=function(p,l){l=l===void 0?{}:l;
g.Ps.call(this,g.JN8[p],Object.assign({},{name:"PESEncoderError",type:p},l));this.type=p;this.level="WARNING";Object.setPrototypeOf(this,f0.prototype)},i1S=function(p){return new f0("WRONG_DATA_TYPE",{G3:p})},pJU=function(p){return p instanceof Error?new f0("UNKNOWN_ENCODE_ERROR",{SA:p.message}):new f0("UNKNOWN_ENCODE_ERROR")},l_$=function(p){return p instanceof Error?new f0("UNKNOWN_DECODE_ERROR",{SA:p.message}):new f0("UNKNOWN_DECODE_ERROR")},QoY=function(p,l){p=p instanceof f0?p:l(p);
g.ul(p);throw p;},$CS=function(){},H1Y=function(p,l,Q){try{return p.X(l,Q)}catch(H){QoY(H,pJU)}},qMY=function(p){p=(new TextEncoder).encode(p).subarray(0,16);
var l=new Uint8Array(16);l.set(p);return l},gI=function(p){this.B=p},cw$=function(p){var l=WR8[p];
if(l)return l;g.K2(new g.Ps("Entity model not found.",{entityType:p}))},tdo=function(p,l){this.B=p;
this.L=l;this.X={}},RGt=function(p,l){a:{p=ExS(p.L,l.version);
try{var Q=p.L(l.data,l.key);break a}catch(H){QoY(H,l_$)}Q=void 0}return Q},sV=function(p,l,Q){return p.B.objectStore("EntityStore").get(l).then(function(H){if(H){if(Q&&H.entityType!==Q)throw Error("Incorrect entity type");
return RGt(p,H)}})},bB=function(p,l,Q){return Q?(Q=Q.map(function(H){return sV(p,H,l)}),g.Yd.all(Q)):p.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(l)).then(function(H){return H.map(function(q){return RGt(p,q)})})},x8=function(p,l,Q){var H=O68(l),q=ExS(p.L,1),W=Object.assign({},l);
return p.B.objectStore("EntityStore").get(H).then(function(c){if(c){if(c.entityType!==Q)throw Error("Incorrect entity type");W.entityMetadata||(c=RGt(p,c),W.entityMetadata=c.entityMetadata)}}).then(function(){var c={key:H,
entityType:Q,data:H1Y(q,W,H),version:1};return g.Yd.all([g.N$(p.B.objectStore("EntityStore"),c),FR8(p,W,Q)])}).then(function(){PR(p,H,Q);
return H})},rwY=function(p,l,Q){l=l.map(function(H){return x8(p,H,Q)});
return g.Yd.all(l)},UV=function(p,l,Q){if(Q==null?0:Q.GK){var H=new Set;
return dCY(p,l,H).then(function(){for(var W=[],c=g.Z(H),E=c.next();!E.done;E=c.next())W.push(UV(p,E.value));return g.Yd.all(W).then(function(){})})}var q=g.Cu(l).entityType;
return g.Yd.all([p.B.objectStore("EntityStore").delete(l),joS(p,l)]).then(function(){PR(p,l,q)})},Mdo=function(p,l){return g.oK(p.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(l)},function(Q){return g.Yd.all([Q.delete(),
joS(p,Q.cursor.primaryKey)]).then(function(){PR(p,Q.cursor.primaryKey,l);return g.yL(Q)})})},TSb=function(p,l,Q,H){var q=ExS(p.L,1);
return sV(p,l,H).then(function(W){if(W){W=g.j6(W,Q);var c={key:l,entityType:H,data:H1Y(q,W,l),version:1};return g.Yd.all([g.N$(p.B.objectStore("EntityStore"),c),FR8(p,W,H)])}}).then(function(){PR(p,l,H);
return l})},PR=function(p,l,Q){var H=p.X[Q];
H||(H=new Set,p.X[Q]=H);H.add(l)},eG8=function(p,l,Q){var H=O68(l);
Q=cw$(Q);if(!Q)return g.Yd.resolve([]);Q=new Q(l);p=p.B.objectStore("EntityAssociationStore");l=[];Q=g.Z(Q.L());for(var q=Q.next();!q.done;q=Q.next())l.push(g.N$(p,{parentEntityKey:H,childEntityKey:q.value}));return g.Yd.all(l).then(function(W){return W.map(function(c){return c[1]})})},joS=function(p,l){return p.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l))},FR8=function(p,l,Q){var H=O68(l);
return joS(p,H).then(function(){return eG8(p,l,Q)})},dCY=function(p,l,Q){if(Q.has(l))return g.Yd.resolve(void 0);
Q.add(l);return zG$(p,l).then(function(H){return p.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l)).then(function(){return H})}).then(function(H){var q=g.Yd.resolve(void 0);
H=g.Z(H);for(var W=H.next(),c={};!W.done;c={KC:void 0},W=H.next())c.KC=W.value,q=q.then(function(E){return function(){return dCY(p,E.KC,Q)}}(c));
return q}).then(function(){})},zG$=function(p,l){var Q=p.B.objectStore("EntityAssociationStore");
return Q.index("byParentEntityKey").getAll(IDBKeyRange.only(l)).then(function(H){var q=[];H=g.Z(H);for(var W=H.next();!W.done;W=H.next())W=W.value,q.push(Q.index("byChildEntityKey").getAll(W.childEntityKey));return g.Yd.all(q)}).then(function(H){var q=[];
H=g.Z(H);for(var W=H.next();!W.done;W=H.next())W=W.value,W.length===1&&q.push(W[0].childEntityKey);return q})},C0=function(){},Z1o=function(){this.B={};
this.B[0]=new C0;if(!g.ZC("aes_pes_encoder_killswitch")){var p=this.B;try{var l=g.x$();var Q=qMY(l);var H=new gI(new g.BB(Q),new g.Zq(Q))}catch(q){throw p=q instanceof Error?new f0("KEY_CREATION_FAILED",{SA:q.message}):new f0("KEY_CREATION_FAILED"),g.ul(p),p;}p[1]=H}},ExS=function(p,l){l=l===void 0?0:l;
p=p.B[l];if(!p)throw l=new f0("INVALID_ENCODER_VERSION",{G3:l}),g.ul(l),l;return p},OV=function(p,l){g.L.call(this);
this.token=p;this.B=l;this.observers=[];p=new g.Jg.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.x$());p.onmessage=this.L.bind(this);this.channel=p},vR=function(p,l,Q){var H,q,W,c;
return g.V(function(E){if(E.B==1)return g.S(E,mxo(p.token),2);if(E.B!=3)return H=E.L,g.S(E,g.Sz(H,["EntityStore","EntityAssociationStore"],l,function(R){q=new tdo(R,p.B);return Q(q)}),3);
W=E.L;q&&(c=q.X,Object.keys(c).length>0&&(p.channel.postMessage(c),BS5(p,c)));return E.return(W)})},mY=function(p,l,Q){return vR(p,{mode:"readwrite",
Es:!0},function(H){return x8(H,l,Q)})},YM8=function(p,l){return vR(p,{mode:"readwrite",
Es:!0},function(Q){return rwY(Q,l,"offlineOrchestrationActionWrapperEntity")})},hGb=function(p,l){return vR(p,{mode:"readwrite",
Es:!0},function(Q){return UV(Q,l)})},a_o=function(p){return vR(p,{mode:"readwrite",
Es:!0},function(l){return Mdo(l,"videoPlaybackPositionEntity")})},GB=function(p,l,Q){return vR(p,{mode:"readonly",
Es:!0},function(H){return sV(H,l,Q)})},it=function(p,l,Q){return vR(p,{mode:"readonly",
Es:!0},function(H){return bB(H,l,Q)})},BS5=function(p,l){p=g.Z(p.observers);
for(var Q=p.next();!Q.done;Q=p.next())Q=Q.value,Q(l)},I_b=function(){var p,l,Q;
return g.V(function(H){if(H.B==1)return g.Yl(H,2),g.S(H,g.vA(),4);if(H.B!=2){p=H.L;if(!p||!g.UK()||typeof g.Jg.BroadcastChannel==="undefined")return H.return();l=new Z1o;return H.return(new OV(p,l))}Q=g.Ic(H);Q instanceof Error&&g.ul(Q);return H.return()})},pc=function(){DCK||(DCK=I_b());
return DCK},nx8=function(p){var l;
p=(l=p.options)==null?void 0:l.persistenceOption;return p==="ENTITY_PERSISTENCE_OPTION_PERSIST"||p==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},XJS=function(p){var l;
return g.V(function(Q){return Q.B==1?g.S(Q,pc(),2):(l=Q.L)?g.S(Q,vR(l,"readwrite",function(H){for(var q={},W=g.Z(p),c=W.next(),E={};!c.done;E={wH:void 0,L5:void 0},c=W.next())E.wH=c.value,E.wH.entityKey&&nx8(E.wH)&&(E.L5=g.Xy(E.wH.payload),c=void 0,E.wH.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(c=function(R){return function(){return x8(H,R.wH.payload[R.L5],R.L5)}}(E)),E.wH.type==="ENTITY_MUTATION_TYPE_DELETE"&&(c=function(R){return function(){return UV(H,R.wH.entityKey)}}(E)),E.wH.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(c=function(R){return function(){return TSb(H,R.wH.entityKey,R.wH.payload[R.L5],R.L5)}}(E)),c&&(q[E.wH.entityKey]=q[E.wH.entityKey]?q[E.wH.entityKey].then(c):c()));
return g.Yd.all(Object.values(q))}),0):Q.return()})},wJ8=function(p){var l;
return g.V(function(Q){if(Q.B==1){l=p.mutations;if(!l||l.length<=0)return Q.return();if(g.iZ){var H={type:"ENTITY_LOADED"};l!==void 0&&(H.payload=l);g.iZ.dispatch(H)}return g.S(Q,XJS(l),2)}l.length=0;g.Bi(Q)})},SMo=function(p){return p!==void 0},NSY=function(p){var l=g.np();
l=Object.assign({},l);p=Object.assign({},p);for(var Q in l)p[Q]?(l[Q]!==4&&(l[Q]=p[Q]),delete p[Q]):l[Q]!==2&&(l[Q]=4);Object.assign(l,p);g.GiJ(l);JSON.stringify(l);return l},VdG=function(p){var l,Q;
return g.V(function(H){if(H.B==1)return g.S(H,g.vA(),2);if(H.B!=3)return(l=H.L)?g.S(H,g.SR(l),3):H.return();Q=H.L;return H.return(g.Sz(Q,["index","media","captions"],{mode:"readwrite",Es:!0},function(q){var W=IDBKeyRange.bound(p+"|",p+"~");q=[q.objectStore("index").delete(W),q.objectStore("media").delete(W),q.objectStore("captions").delete(W)];return g.Yd.all(q).then(function(){})}))})},kK8=function(){var p,l;
return g.V(function(Q){if(Q.B==1)return g.S(Q,g.vA(),2);if(Q.B!=3){p=Q.L;if(!p)throw g.ZX("rvdfd");return g.S(Q,g.SR(p),3)}l=Q.L;return Q.return(g.Sz(l,["index","media"],{mode:"readwrite",Es:!0},function(H){var q={};return g.K8(H.objectStore("index"),{},function(W){var c=W.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),E=g.Yd.resolve(void 0);if(c){var R=c[1];c=c[2];q[R]=q[R]||{};var F;q[R][c]=g.$DP((F=W.getValue())==null?void 0:F.fmts)}else E=W.delete().then(function(){});
return g.Yd.all([g.yL(W),E]).then(function(r){return g.Z(r).next().value})}).then(function(){for(var W={},c=g.Z(Object.keys(q)),E=c.next();!E.done;E=c.next()){E=E.value;
var R=q[E].v;W[E]=q[E].a&&R?1:2}var F=NSY(W);return g.XFW(H.objectStore("media"),{},function(r){var d=r.cursor.key.match(g.c5i);d&&W[d[1]]||H.objectStore("media").delete(r.cursor.key);return g.zWP(r)}).then(function(){return F})})}))})},ueY=function(p,l){var Q,H;
return g.V(function(q){if(q.B==1)return g.S(q,g.vA(),2);if(q.B!=3){Q=q.L;if(!Q)throw g.ZX("wct");return g.S(q,g.SR(Q),3)}H=q.L;return g.S(q,g.Sz(H,["captions"],{mode:"readwrite",Es:!0},function(W){var c=[];W=W.objectStore("captions");for(var E=0;E<l.length;E++){var R=g.N$(W,l[E],p+"|"+l[E].metadata.vss_id);c.push(R)}return g.Yd.all(c)}),0)})},KRY=function(p){var l,Q,H;
return g.V(function(q){if(q.B==1)return l=IDBKeyRange.bound(p+"|",p+"~"),g.S(q,g.vA(),2);if(q.B!=3){Q=q.L;if(!Q)throw g.ZX("gactfv");return g.S(q,g.SR(Q),3)}H=q.L;return q.return(H.getAll("captions",l))})},ywo=function(p){return g.V(function(l){g.w3(p,0);
return l.return(VdG(p))})},LRC=function(p){return{context:g.Oi(),
videoIds:p}},oxK=function(p){return{context:g.Oi(),
playlistIds:p}},Awt=function(p){return{context:g.Oi(),
offlinePlaylistSyncChecks:p}},Jw8=function(){this.B=new Map},gxG=function(){f_8||(f_8=new Jw8);
return f_8},soU=function(p,l){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:p},metadata:l,statusCode:void 0,csn:void 0,can:void 0}},b1U=function(p,l,Q){if(!Q){var H=H===void 0?!1:H;
Q=p.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Q||H)Q=g.h3(16),p.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Q)}p={flowNonce:Q,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:l.eventType};l.metadata&&(p.flowMetadata=l.metadata);l.statusCode!==void 0&&(p.flowEventStatus=l.statusCode);l.csn&&(p.csn=l.csn);l.can&&(p.can=l.can);g.cA("flowEvent",p,void 0)},PQJ=function(p){var l,Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et,I,n,w;
return g.V(function(k){if(k.B==1)return g.S(k,vR(p,{mode:"readonly",Es:!0},function(y){return bB(y,"playbackData").then(function(pW){var Hi=pW.map(function(T$){return T$.transfer}).filter(function(T$){return!!T$}),qr=pW.map(function(T$){return T$.offlineVideoPolicy}).filter(function(T$){return!!T$}),K=pW.filter(function(T$){return!!T$.key}).map(function(T$){return g.OY(g.Cu(T$.key).entityId,"downloadStatusEntity")});
Hi=bB(y,"transfer",Hi);qr=bB(y,"offlineVideoPolicy",qr);K=bB(y,"downloadStatusEntity",K);var Rc=Hi.then(function(T$){T$=T$.reduce(function(tg,Nr){(Nr==null?0:Nr.offlineVideoStreams)&&tg.push.apply(tg,g.h(Nr.offlineVideoStreams));return tg},[]).filter(function(tg){return!!tg});
return bB(y,"offlineVideoStreams",T$)});
return g.Yd.all([Hi,qr,Rc,K]).then(function(T$){var tg=g.Z(T$);T$=tg.next().value;var Nr=tg.next().value;var TU=tg.next().value;tg=tg.next().value;return[pW,T$,Nr,TU,tg]})})}),2);
if(k.B!=3)return l=k.L,g.S(k,vR(p,{mode:"readonly",Es:!0},function(y){return bB(y,"mainDownloadsListEntity").then(function(pW){var Hi,qr;return(qr=(Hi=pW[0])==null?void 0:Hi.downloads)!=null?qr:[]})}),3);
Q=k.L;H=g.Z(l);q=H.next().value;W=H.next().value;c=H.next().value;E=H.next().value;R=H.next().value;F=q;r=W;d=c;M=E;T=R;e={};Y={};a={};D={};X={};N=[];u=g.Z(r);for(J=u.next();!J.done;J=u.next())(iP=J.value)&&(e[iP.key]=iP);C=g.Z(d);for($l=C.next();!$l.done;$l=C.next())(Wi=$l.value)&&(Y[Wi.key]=Wi);G=g.Z(T);for(b=G.next();!b.done;b=G.next())(m=b.value)&&(a[m.key]=m);B=g.Z(M);for(P=B.next();!P.done;P=B.next())(fW=P.value)&&(D[fW.key]=fW);aY=g.Z(Q);for(M8=aY.next();!M8.done;M8=aY.next())nW=M8.value,i8=
void 0,X[(i8=nW.videoItem)!=null?i8:""]=!0,nW.videoItem&&(et=W$=void 0,I=(et=(W$=g.Cu(nW.videoItem))==null?void 0:W$.entityId)!=null?et:"",N.push({externalVideoId:I}));n=F.filter(function(y){if(!y||!y.key||!y.offlineVideoPolicy)return!1;y=g.Cu(y.key).entityId;y=g.OY(y,"downloadStatusEntity");var pW;return!(y&&((pW=a[y])==null?void 0:pW.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
w=n.map(function(y){var pW=e[y.transfer],Hi=[];if(pW==null?0:pW.offlineVideoStreams)for(var qr=g.Z(pW.offlineVideoStreams),K=qr.next();!K.done;K=qr.next())(K=D[K.value])&&Hi.push(K);qr=Y[y.offlineVideoPolicy];K=X;var Rc=y==null?void 0:y.playerResponseTimestamp,T$=g.Cu(qr.key).entityId;y=g.OY(T$,"mainVideoEntity");if(qr.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var tg="OFFLINE_VIDEO_STATE_DISABLED";qr.expirationTimestamp&&Number(qr.expirationTimestamp)<Date.now()/1E3&&(tg="OFFLINE_VIDEO_STATE_EXPIRED")}else if(qr.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")tg="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(pW==null?void 0:pW.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":tg="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":tg="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":tg="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":tg="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":tg="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":tg="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:tg="OFFLINE_VIDEO_STATE_UNKNOWN"}if(tg==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(pW==null?void 0:pW.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":tg="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":tg="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":tg=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}T$={id:T$,videoState:tg};if(pW==null?0:pW.cotn)T$.cotn=pW.cotn;if(pW==null?0:pW.maximumDownloadQuality)T$.selectedVideoQuality=pW==null?void 0:pW.maximumDownloadQuality;if(pW==null?0:pW.lastProgressTimeMs)T$.lastProgressTimeMs=pW.lastProgressTimeMs;Rc&&(T$.playerResponseSavedTimeMs=String(Number(Rc)*1E3));pW=String;Rc=0;Hi=g.Z(Hi);for(tg=Hi.next();!tg.done;tg=Hi.next())if(tg=tg.value,tg.streamsProgress){tg=g.Z(tg.streamsProgress);for(var Nr=tg.next();!Nr.done;Nr=
tg.next()){var TU=void 0;Rc+=Number((TU=Nr.value.numBytesDownloaded)!=null?TU:0)}}T$.downloadedBytes=pW(Rc);T$.selectedOfflineMode=K[y]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";qr.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(T$.offlinePlaybackDisabledReason=qr.offlinePlaybackDisabledReason);return T$});
return k.return({offlineVideos:w,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:N}}})})},xC8=function(){this.locks=navigator.locks},UCG=function(){try{var p=g.sX("ytglobal.locks_");
if(p)return p;var l;if(l=navigator){var Q=navigator;l="locks"in Q&&!!Q.locks}if(l)return g.Jg.localStorage&&g.Jg.localStorage.getItem("noop"),p=new xC8,g.gy("ytglobal.locks_",p),p}catch(H){}},lt=function(){},CQY=function(){},O1S=function(p){if(p.includes(":"))throw Error("Invalid user cache name: "+p);
return p+":"+g.x$("CacheStorage get")},vx8=function(){return g.V(function(p){if(Q8!==void 0)return p.return(Q8);
Q8=new Promise(function(l){var Q;return g.V(function(H){switch(H.B){case 1:return g.Yl(H,2),g.S(H,$P.open("test-only"),4);case 4:return g.S(H,$P.delete("test-only"),5);case 5:g.ac(H,3);break;case 2:if(Q=g.Ic(H),Q instanceof Error&&Q.name==="SecurityError")return l(!1),H.return();case 3:l("caches"in window),g.Bi(H)}})});
return p.return(Q8)})},GKG=function(){return g.V(function(p){if(p.B==1)return g.S(p,vx8(),2);
if(!p.L)return p.return(void 0);mC8||(mC8=new CQY);return p.return(mC8)})},HY=function(p,l,Q){g.K2(new g.Ps("Woffle: "+p,Q?{cotn:Q}:""));
l instanceof Error&&g.K2(l)},iDo=function(p){var l;
return g.V(function(Q){if(Q.B==1)return g.S(Q,PQJ(p),2);l=Q.L;g.cA("offlineStateSnapshot",l);g.Bi(Q)})},qs=function(p){g.L.call(this);
var l=this;this.api=p;this.tR={lBd:function(){return l.B},
O8m:function(){return l.L}};
typeof g.Jg.BroadcastChannel!=="undefined"&&(this.B=new g.Jg.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.x$()),this.B.onmessage=this.X.bind(this),this.L=new g.Jg.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.x$()),this.L.onmessage=this.j.bind(this))},WY=function(p,l){p.api.bO("onOfflineOperationFailure",l);
var Q;(Q=p.B)==null||Q.postMessage(l)},puo=function(p,l,Q,H){var q=this;
this.T=p;this.Y=l;this.visibility=Q;this.D=H;this.W=this.S=this.C=this.X=this.B=!1;this.j=new g.x_(function(){q.p6()});
this.tR={rQ:function(){return q.L},
p6:function(){q.p6()},
DvP:function(){return q.j}};
this.visibility.subscribe("visibilitystatechange",function(){q.Br()})},lao=function(p){if(!p.X&&!p.B){var l=UCG();
if(l){p.X=!0;var Q=g.x$("OfflineLockManager");l.request("woffle_orchestration_leader:"+Q,{},function(){var H,q,W,c;return g.V(function(E){switch(E.B){case 1:return g.Yl(E,2),p.L=new g.h$,p.B=!0,p.X=!1,g.S(E,p.T(),4);case 4:return g.S(E,p.L.promise,5);case 5:g.ac(E,0);break;case 2:H=g.Ic(E),((W=(q=p).D)==null?0:W.call(q,"wo_relinquish_leadership_on_lock_request_error"))||p.p6(),H instanceof Error&&(c=H,c.args=[{name:"WoLockManagerError",m2:H.name}],g.ul(c)),g.Bi(E)}})})}}},Quo=function(p){p.B&&(p.W=
!0,cY(p))},$EG=function(p,l){p.B&&(p.C=l,cY(p))},HDK=function(p,l){p.B&&(p.S=l,cY(p))},cY=function(p){p.S&&p.C&&p.W&&p.visibility.isBackground()?g.Ua(p.j,6E4):p.j.stop()},tU=function(p){var l;
p.offlineDeleteReason=(l=p.offlineDeleteReason)!=null?l:"OFFLINE_DELETE_REASON_UNKNOWN";var Q;p.offlineModeType=(Q=p.offlineModeType)!=null?Q:"OFFLINE_NOW";g.cA("offlineDeleteEvent",p)},E3=function(p,l){var Q=l.videoId;
var H=l.tq;l=l.offlineModeType;p.encryptedVideoId=Q;p.cotn=H==null?void 0:H.cotn;p.offlineabilityFormatType=H==null?void 0:H.maximumDownloadQuality;var q;p.isRefresh=(q=H==null?void 0:H.isRefresh)!=null?q:!1;var W;p.softErrorCount=(W=H==null?void 0:H.transferRetryCount)!=null?W:0;p.offlineModeType=l!=null?l:"OFFLINE_NOW";(p.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&p.statusType==="UNKNOWN_STATUS_TYPE"||!p.transferStatusType&&!p.statusType)&&g.K2(Error("Woffle unknown transfer status"));
g.cA("offlineTransferStatusChanged",p)},qIb=function(p,l,Q,H){H={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!H};l&&Q&&(l=Math.floor(l/1024).toFixed(),Q=Math.floor(Q/1024).toFixed(),H.alreadyDownloadedKbytes=l,H.totalFetchedKbytes=l,H.totalContentKbytes=Q);E3(H,p)},WtJ=function(p){E3({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},p)},cY8=function(p){switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Rw=function(p){var l,Q,H;
return((H=(l=p.actionMetadata)==null?void 0:(Q=l.retryScheduleIntervalsInSeconds)==null?void 0:Q.length)!=null?H:0)>0},FG=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!p.entityKey},rm=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!p.entityKey},dm=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!p.entityKey},t8K=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!p.entityKey},
j4=function(p,l,Q,H,q){q=q===void 0?!1:q;
var W,c,E,R,F,r;return g.V(function(d){if(d.B==1)return W=g.OY(p,l),c=g.OY(p,"downloadStatusEntity"),g.S(d,vR(Q,{mode:"readonly",Es:!0},function(M){return g.Yd.all([sV(M,W,l),sV(M,c,"downloadStatusEntity")])}),2);
E=d.L;R=E.length?E[0]:void 0;if(!R)return d.q3(0);F=EY5;if(r=E.length>1?E[1]:void 0){if(r.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!q)return d.return();r.downloadState=H}else r={key:c,downloadState:H};g.Jc(R,F,r);return g.S(d,vR(Q,{mode:"readwrite",Es:!0},function(M){return g.Yd.all([x8(M,R,l),x8(M,r,"downloadStatusEntity")])}),0)})},Ms=function(p,l){return p.actionType===l.actionType&&p.entityKey===l.entityKey},TV=function(p,l){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!==
"TRANSFER_STATE_FAILED"){var Q=g.Cu(p.key).entityId;
E3({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Q,tq:p,offlineModeType:l})}},e4=function(p){if(!p||!p.thumbnails)return[];
var l=[];p=g.Z(p.thumbnails);for(var Q=p.next();!Q.done;Q=p.next())Q=Q.value,Q.url&&l.push(Q.url);return l},Rb8=function(p,l,Q){Q=Q===void 0?[]:Q;
var H,q,W,c,E,R,F,r,d,M,T,e,Y;return g.V(function(a){if(a.B==1)return Q.length?g.S(a,it(p,l),2):a.return([]);H=a.L;q=new Set;W=g.Z(H);for(c=W.next();!c.done;c=W.next())if(E=c.value,R=E.id||E.key)F=g.Cu(R).entityId,q.add(F);r=[];d=g.Z(Q);for(M=d.next();!M.done;M=d.next())T=M.value,e=T.offlineVideoData,Y=void 0,((Y=e)==null?0:Y.videoId)&&!q.has(e.videoId)&&r.push(T);return a.return(r)})},FtK=function(p,l,Q){return new g.g3(p,{cotn:l,
raw_player_response:Q,download_media:!0,start:Infinity,disable_watch_next:!0})},rYJ=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},zV=function(p,l,Q,H,q,W,c,E,R,F,r){this.entityType=p;
this.actionId=l;this.action=Q;this.parentActionId=H;this.rootActionId=q===void 0?l:q;this.childActionIds=W;this.prereqActionId=c;this.postreqActionIds=E;this.hasChildActionFailed=F;this.retryScheduleIndex=0;this.B=r||Date.now();this.retryScheduleIndex=R||0},Zb=function(p){if(!p.key)throw Error("Entity key is required.");
if(!p.actionProto)throw Error("OfflineOrchestrationAction is required.");var l=g.Cu(p.key),Q=g.Cu(p.actionProto.entityKey);return new zV(Q.entityType,l.entityId,p.actionProto,p.parentActionId,p.rootActionId,p.childActionIds,p.prereqActionId,p.postreqActionIds,p.retryScheduleIndex,p.hasChildActionFailed,Number(p.enqueueTimeSec)*1E3)},BY=function(p){return{key:g.OY(p.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:p.action,parentActionId:p.parentActionId,rootActionId:p.rootActionId,childActionIds:p.childActionIds,prereqActionId:p.prereqActionId,postreqActionIds:p.postreqActionIds,retryScheduleIndex:p.retryScheduleIndex,hasChildActionFailed:p.hasChildActionFailed,enqueueTimeSec:(p.B/1E3).toFixed()}},dEC=function(){var p;
return g.V(function(l){return l.B==1?g.S(l,GKG(),2):(p=l.L)?l.return(p.delete("yt-player-local-img")):l.return(!0)})},YP=function(p){var l,Q;
return g.V(function(H){if(H.B==1)return g.S(H,GKG(),2);if(H.B!=3){l=H.L;if(!l)throw Error("Cache API not supported");return p.length?g.S(H,l.open("yt-player-local-img"),3):H.return()}Q=H.L;return g.S(H,Promise.all(p.map(function(q){return Q.delete(q)})),0)})},hU=function(p){var l,Q;
return g.V(function(H){if(H.B==1)return g.S(H,GKG(),2);if(H.B!=3){l=H.L;if(!l)throw Error("Cache API not supported");return p.length?g.S(H,l.open("yt-player-local-img"),3):H.return()}Q=H.L;return g.S(H,Q.addAll(p),0)})},aw=function(p,l,Q,H,q){var W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8;
return g.V(function(W$){switch(W$.B){case 1:return W=g.OY(p,"mainVideoEntity"),c=g.OY(p,"ytMainChannelEntity"),E=g.OY(p,"transfer"),R=g.OY(p,"videoDownloadContextEntity"),g.S(W$,vR(l,{mode:"readonly",Es:!0},function(et){return g.Yd.all([sV(et,W,"mainVideoEntity"),sV(et,c,"ytMainChannelEntity"),sV(et,E,"transfer"),sV(et,R,"videoDownloadContextEntity"),bB(et,"ytMainChannelEntity"),bB(et,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:F=W$.L;r=g.Z(F);d=r.next().value;M=r.next().value;T=r.next().value;e=r.next().value;Y=r.next().value;a=r.next().value;D=d;X=M;N=T;u=e;J=Y;iP=a;if(!D&&!X){W$.q3(3);break}C=D?e4(D.thumbnail):[];if(!X){$l=[];W$.q3(4);break}return g.S(W$,juo(X,J),5);case 5:$l=W$.L;case 4:return Wi=$l,g.S(W$,YP(C.concat(Wi)),3);case 3:G=[];b=g.OY(p,"downloadStatusEntity");m=g.Z(iP);for(B=m.next();!B.done;B=m.next())P=B.value,fW=g.Cu(P.key).entityId,aY=Zb(P),M8=g.Cu(aY.action.entityKey).entityId,fW!==p&&M8!==p||
Ms(Q,P.actionProto)||G.push(P.key);return g.S(W$,vR(l,{mode:"readwrite",Es:!0},function(et){var I=G.map(function(n){return UV(et,n)});
I.push(UV(et,W,{GK:!0}));I.push(UV(et,b,{GK:!0}));return g.Yd.all(I)}),7);
case 7:i8=(nW=u)==null?void 0:nW.offlineModeType,q&&(tU(q),q.offlineModeType&&(i8=q.offlineModeType)),TV(N,i8),WY(H,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Bi(W$)}})},ebJ=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et,I,n,w,k,y,pW,Hi,qr,K,Rc,T$,tg,Nr,TU,JS,jC;
return g.V(function(xl){switch(xl.B){case 1:return q=g.OY(p,"mainPlaylistEntity"),W=g.OY(p,"ytMainChannelEntity"),g.S(xl,vR(l,{mode:"readonly",Es:!0},function(fq){return g.Yd.all([sV(fq,q,"mainPlaylistEntity"),sV(fq,W,"ytMainChannelEntity"),bB(fq,"mainPlaylistEntity"),bB(fq,"mainDownloadsListEntity"),bB(fq,"ytMainChannelEntity"),bB(fq,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=xl.L;E=g.Z(c);R=E.next().value;F=E.next().value;r=E.next().value;d=E.next().value;M=E.next().value;T=E.next().value;e=R;Y=F;a=r;D=d;X=M;N=T;if(!e&&!Y){xl.q3(3);break}u=e?M8b(e):[];if(!Y){J=[];xl.q3(4);break}return g.S(xl,juo(Y,X),5);case 5:J=xl.L;case 4:return iP=J,g.S(xl,YP(u.concat(iP)),3);case 3:C=[];$l=new Map;if(!e){xl.q3(7);break}return g.S(xl,TEC(e,a,D),8);case 8:C=xl.L;Wi=g.Z(C);for(G=Wi.next();!G.done;G=Wi.next())b=G.value,$l.set(b,{videoId:b,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.S(xl,vR(l,{mode:"readonly",Es:!0},function(fq){return g.Yd.all([bB(fq,"transfer"),bB(fq,"videoDownloadContextEntity")])}),9);
case 9:m=xl.L;B=g.Z(m);P=B.next().value;fW=B.next().value;aY=P;M8=fW;nW=g.Z(aY);for(i8=nW.next();!i8.done;i8=nW.next())W$=i8.value,et=g.Cu(W$.key).entityId,(I=$l.get(et))&&W$&&(I.cotn=W$.cotn);n=g.Z(M8);for(w=n.next();!w.done;w=n.next())k=w.value,y=g.Cu(k.key).entityId,(pW=$l.get(y))&&k&&(pW.offlineModeType=k.offlineModeType);case 7:Hi=[];qr=g.Z(N);for(K=qr.next();!K.done;K=qr.next())Rc=K.value,T$=g.Cu(Rc.key).entityId,tg=Zb(Rc),T$!==p&&tg.rootActionId!==p||Ms(Q,Rc.actionProto)||Hi.push(Rc.key);Nr=
g.OY(p,"mainPlaylistEntity");return g.S(xl,vR(l,{mode:"readwrite",Es:!0},function(fq){var Ew=Hi.map(function(KV){return UV(fq,KV)});
Ew.push(UV(fq,Nr,{GK:!0}));return g.Yd.all(Ew)}),10);
case 10:if(!e){xl.q3(0);break}C.reverse();if(!C){xl.q3(0);break}TU=g.Z(C);JS=TU.next();case 13:if(JS.done){xl.q3(0);break}jC=JS.value;return g.S(xl,aw(jC,l,Q,H,$l.get(jC)),14);case 14:JS=TU.next(),xl.q3(13)}})},ZDY=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M;
return g.V(function(T){if(T.B==1)return q=g.OY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),W=new Map,g.S(T,vR(p,{mode:"readwrite",Es:!0},function(e){var Y=bB(e,"transfer"),a=bB(e,"offlineOrchestrationActionWrapperEntity"),D=bB(e,"videoDownloadContextEntity"),X=sV(e,q,"mainDownloadsListEntity");return g.Yd.all([Y,a,D,X]).then(function(N){N=g.Z(N);var u=N.next().value;var J=N.next().value;var iP=N.next().value;var C=N.next().value;N=zbJ.map(function(Wi){return Mdo(e,Wi)});
J=g.Z(J);for(var $l=J.next();!$l.done;$l=J.next())$l=$l.value,Ms(l,$l.actionProto)||N.push(UV(e,$l.key,{GK:!0}));C&&(C.downloads=[],N.push(x8(e,C,"mainDownloadsListEntity")));if(iP)for(iP=g.Z(iP),C=iP.next();!C.done;C=iP.next())C=C.value,J=g.Cu(C.key).entityId,J=g.OY(J,"transfer"),W.set(J,C.offlineModeType);return g.Yd.all(N).then(function(){return u})})}),2);
c=T.L;E=g.Z(c);for(R=E.next();!R.done;R=E.next())F=R.value,TV(F,W.get(F.key)),r=g.Cu(F.key).entityId,d={videoId:r,offlineDeleteReason:H,cotn:F.cotn,offlineModeType:W.get(F.key)},tU(d),M=g.OY(r,"mainVideoEntity"),WY(Q,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.S(T,dEC(),0)})},M8b=function(p,l){var Q=[];
if(p.thumbnailStyleData){p=g.Z(p.thumbnailStyleData);for(var H=p.next();!H.done;H=p.next()){var q=void 0,W=void 0,c=void 0;Q=Q.concat(e4((q=H.value)==null?void 0:(W=q.value)==null?void 0:(c=W.collageThumbnail)==null?void 0:c.coverThumbnail))}}l=e4(l);return Q.concat(l)},TEC=function(p,l,Q){var H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi;
return g.V(function(G){H=[];q=new Set;if(Q.length)for(W=g.Z(Q),c=W.next();!c.done;c=W.next())if(E=c.value,R=void 0,(R=E.downloads)==null?0:R.length)for(F=g.Z(E.downloads),r=F.next();!r.done;r=F.next())d=r.value,d.videoItem&&(M=g.Cu(d.videoItem).entityId,q.add(M));if(p.videos){T=g.Z(p.videos);for(e=T.next();!e.done;e=T.next())Y=e.value,a=JSON.parse(g.Cu(Y).entityId),a.videoId&&!q.has(a.videoId)&&H.push(a.videoId);D=g.Z(l);for(X=D.next();!X.done;X=D.next())if(N=X.value,N.key!==p.key&&(u=N.videos))for(J=
g.Z(u),iP=J.next();!iP.done;iP=J.next())C=iP.value,$l=JSON.parse(g.Cu(C).entityId),$l.videoId&&(Wi=H.indexOf($l.videoId),Wi!==-1&&H.splice(Wi,1))}return G.return(H)})},juo=function(p,l){var Q,H,q,W,c,E,R,F;
return g.V(function(r){Q=e4(p.avatar);H=g.Z(l);for(q=H.next();!q.done;q=H.next())if(W=q.value,W.id!==p.id)for(c=g.Z(e4(W.avatar)),E=c.next();!E.done;E=c.next())R=E.value,F=Q.indexOf(R),F!==-1&&Q.splice(F,1);return r.return(Q)})},BEU=function(p){var l;
return g.V(function(Q){l=g.f(p.frameworkUpdates,Iw);return p.frameworkUpdates&&l?g.S(Q,wJ8(l),0):Q.return()})},hbo=function(p){var l;
if((l=p.onResponseReceivedActions)!=null&&l.length){var Q;p=(Q=g.f(g.f(p.onResponseReceivedActions[0],YI5),g.uTS))==null?void 0:Q.actions;if(p!=null&&p.length)return p}},aa8=function(p){var l,Q,H;
return g.V(function(q){if(q.B==1)return p?g.S(q,GB(p,g.VZ,"mainDownloadsListEntity"),2):q.return([]);l=q.L;return((Q=l)==null?0:(H=Q.downloads)==null?0:H.length)?q.return(l.downloads.map(function(W){var c;return(c=W.videoItem)!=null?c:""})):q.return([])})},DE8=function(p,l){var Q;
return g.V(function(H){return H.B==1?g.S(H,IaC(p,l),2):(Q=H.L)?g.S(H,vR(p,{mode:"readwrite",Es:!0},function(q){var W=[x8(q,Q.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Q.mainDownloadsListEntity&&W.push(x8(q,Q.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Yd.all(W)}),0):H.q3(0)})},IaC=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N;
return g.V(function(u){if(u.B==1)return Q=g.OY("main_downloads_library_id","mainDownloadsLibraryEntity"),H=g.OY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.S(u,vR(p,{mode:"readonly",Es:!0},function(J){return g.Yd.all([sV(J,Q,"mainDownloadsLibraryEntity"),sV(J,H,"mainDownloadsListEntity")])}),2);
q=u.L;W=g.Z(q);c=W.next().value;E=W.next().value;R=c;F=E;R||(R={id:Q});r=g.Z(l);for(d=r.next();!d.done;d=r.next())if(M=d.value,M===g.VZ){if(R.smartDownloadsList)return u.return();R.smartDownloadsList=M}else if(T=g.Cu(M).entityType,e={},T==="mainPlaylistEntity"?e.playlistItem=M:T==="mainVideoEntity"&&(e.videoItem=M),!g.u_(e)){Y=void 0;if((Y=F)==null?0:Y.downloads){a=!1;D=g.Z(F.downloads);for(X=D.next();!X.done;X=D.next())if(N=X.value,N.playlistItem===M||N.videoItem===M){a=!0;break}a||F.downloads.push(e)}else F=
{id:H,downloads:[e]};R.downloadsList=H}return u.return({mainDownloadsLibraryEntity:R,mainDownloadsListEntity:F})})},nYY=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a;
return g.V(function(D){if(D.B==1)return Q=g.OY("main_downloads_library_id","mainDownloadsLibraryEntity"),H=g.OY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.S(D,vR(p,{mode:"readonly",Es:!0},function(X){return g.Yd.all([sV(X,Q,"mainDownloadsLibraryEntity"),sV(X,H,"mainDownloadsListEntity"),sV(X,g.VZ,"mainDownloadsListEntity")])}),2);
q=D.L;W=g.Z(q);c=W.next().value;E=W.next().value;R=W.next().value;F=c;r=E;d=R;if(!F)return D.q3(0);if(l===g.VZ&&((M=d)==null?0:M.downloads))d.downloads=[];else if((T=r)==null?0:T.downloads)for(e=g.Cu(l).entityType,Y=0;Y<r.downloads.length;Y++)if(a=r.downloads[Y],e==="mainVideoEntity"&&a.videoItem===l){r.downloads.splice(Y,1);break}else if(e==="mainPlaylistEntity"&&a.playlistItem===l){r.downloads.splice(Y,1);break}return g.S(D,vR(p,{mode:"readwrite",Es:!0},function(X){var N=[x8(X,F,"mainDownloadsLibraryEntity")];
r&&N.push(x8(X,r,"mainDownloadsListEntity"));d&&N.push(x8(X,d,"mainDownloadsListEntity"));return g.Yd.all(N)}),0)})},Db=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M;
return g.V(function(T){if(T.B==1)return Q=g.OY(l,"transfer"),H=g.OY(l,"videoDownloadContextEntity"),g.S(T,vR(p,{mode:"readonly",Es:!0},function(e){return g.Yd.all([sV(e,Q,"transfer"),sV(e,H,"videoDownloadContextEntity")])}),2);
q=T.L;W=g.Z(q);c=W.next().value;E=W.next().value;R=c;F=E;M={videoId:l,cotn:(r=R)==null?void 0:r.cotn,offlineModeType:(d=F)==null?void 0:d.offlineModeType};return T.return(M)})},nc=function(p,l,Q,H,q){var W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l;
return g.V(function(Wi){switch(Wi.B){case 1:return W=g.OY(p,"musicTrack"),c=g.OY(p,"transfer"),g.S(Wi,vR(l,{mode:"readonly",Es:!0},function(G){return g.Yd.all([sV(G,W,"musicTrack"),sV(G,c,"transfer"),bB(G,"musicTrack"),bB(G,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=Wi.L;R=g.Z(E);F=R.next().value;r=R.next().value;d=R.next().value;M=R.next().value;T=F;e=r;Y=d;a=M;if(!T){Wi.q3(3);break}return g.S(Wi,Xuo(T,Y),4);case 4:return D=Wi.L,g.S(Wi,YP(D),3);case 3:X=[];N=g.Z(a);for(u=N.next();!u.done;u=N.next())J=u.value,iP=g.Cu(J.key).entityId,C=Zb(J),$l=g.Cu(C.action.entityKey).entityId,iP!==p&&$l!==p||Ms(Q,J.actionProto)||X.push(J.key);return g.S(Wi,vR(l,{mode:"readwrite",Es:!0},function(G){var b=X.map(function(m){return UV(G,m)});
b.push(UV(G,W,{GK:!0}));return g.Yd.all(b)}),6);
case 6:TV(e),q&&tU(q),WY(H,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Bi(Wi)}})},XG=function(p,l,Q,H,q){var W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et,I,n,w;
return g.V(function(k){switch(k.B){case 1:return W=g.OY(p,l),c=g.OY("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(k,vR(Q,{mode:"readonly",Es:!0},function(y){return g.Yd.all([sV(y,W,l),sV(y,c,"musicDownloadsLibraryEntity"),bB(y,l),bB(y,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=k.L;R=g.Z(E);F=R.next().value;r=R.next().value;d=R.next().value;M=R.next().value;T=F;e=r;Y=d;a=M;if(!T){k.q3(3);break}return g.S(k,Xuo(T,Y),4);case 4:return D=k.L,g.S(k,YP(D),3);case 3:X=[];N=new Map;if(!T){k.q3(6);break}return g.S(k,wu8(T,Y,e),7);case 7:X=k.L;u=g.Z(X);for(J=u.next();!J.done;J=u.next())iP=J.value,C=g.Cu(iP).entityId,N.set(C,{videoId:C,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.S(k,it(Q,"transfer"),8);case 8:for($l=k.L,Wi=g.Z($l),
G=Wi.next();!G.done;G=Wi.next())b=G.value,m=g.Cu(b.key).entityId,(B=N.get(m))&&b&&(B.cotn=b.cotn);case 6:P=[];fW=g.Z(a);for(aY=fW.next();!aY.done;aY=fW.next())M8=aY.value,nW=g.Cu(M8.key).entityId,i8=Zb(M8),nW!==p&&i8.rootActionId!==p||Ms(H,M8.actionProto)||P.push(M8.key);W$=g.OY(p,l);return g.S(k,vR(Q,{mode:"readwrite",Es:!0},function(y){var pW=P.map(function(Hi){return UV(y,Hi)});
pW.push(UV(y,W$,{GK:!0}));return g.Yd.all(pW)}),9);
case 9:if(!T){k.q3(0);break}X.reverse();if(!X.length){k.q3(0);break}et=g.Z(X);I=et.next();case 12:if(I.done){k.q3(0);break}n=I.value;w=g.Cu(n).entityId;if(!w){k.q3(13);break}return g.S(k,nc(w,Q,H,q,N.get(w)),13);case 13:I=et.next(),k.q3(12)}})},wm=function(p,l,Q){var H,q,W,c,E,R,F;
return g.V(function(r){if(r.B==1)return g.S(r,vR(p,{mode:"readwrite",Es:!0},function(d){var M=bB(d,"transfer"),T=bB(d,"offlineOrchestrationActionWrapperEntity");return g.Yd.all([M,T]).then(function(e){e=g.Z(e);var Y=e.next().value;var a=e.next().value;e=SI$.map(function(u){return Mdo(d,u)});
a=g.Z(a);for(var D=a.next();!D.done;D=a.next()){D=D.value;var X=g.Cu(D.actionProto.entityKey).entityType==="musicTrack",N=D.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Ms(l,D.actionProto)||X&&(!X||N)||e.push(UV(d,D.key,{GK:!0}))}return g.Yd.all(e).then(function(){return Y})})}),2);
H=r.L;q=g.Z(H);for(W=q.next();!W.done;W=q.next())c=W.value,TV(c),E=g.Cu(c.key).entityId,R={videoId:E,offlineDeleteReason:void 0,cotn:c.cotn},tU(R),F=g.OY(E,"musicTrack"),WY(Q,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.S(r,dEC(),0)})},NEJ=function(p){for(var l,Q=g.Z(p.additionalMetadatas),H=Q.next();!H.done;H=Q.next())H=H.value,H.offlineMusicVideoData&&(l=H.offlineMusicVideoData);
var q,W,c,E,R;return{id:g.OY(p.videoId,"musicTrack"),videoId:p.videoId,title:p.title,thumbnailDetails:p.thumbnail,lengthMs:String(Number(p.lengthSeconds)*1E3),albumTitle:(q=l)==null?void 0:q.releaseTitle,musicVideoType:(W=l)==null?void 0:W.musicVideoType,contentRating:{explicitType:(c=l)==null?void 0:c.explicitType},artistNames:((E=l)==null?void 0:E.byline)||((R=l)==null?void 0:R.channelName),downloadMetadata:g.OY(p.videoId,"musicTrackDownloadMetadataEntity")}},wu8=function(p,l,Q){var H,q,W,c,E,R,
F,r,d,M,T,e,Y,a,D,X,N,u;
return g.V(function(J){H=[];q=new Set;if((W=Q)==null?0:(c=W.downloadedTracks)==null?0:c.length)for(E=g.Z(Q.downloadedTracks),R=E.next();!R.done;R=E.next())F=R.value,q.add(F);if(p.tracks){r=g.Z(p.tracks);for(d=r.next();!d.done;d=r.next())M=d.value,q.has(M)||H.push(M);T=g.Z(l);for(e=T.next();!e.done;e=T.next())if(Y=e.value,Y.id!==p.id&&(a=Y.tracks))for(D=g.Z(a),X=D.next();!X.done;X=D.next())N=X.value,u=H.indexOf(N),u!==-1&&H.splice(u,1)}return J.return(H)})},Xuo=function(p,l){var Q,H,q,W,c,E,R,F;
return g.V(function(r){Q=e4(p.thumbnailDetails);H=g.Z(l);for(q=H.next();!q.done;q=H.next())if(W=q.value,W.id!==p.id)for(c=g.Z(e4(W.thumbnailDetails)),E=c.next();!E.done;E=c.next())R=E.value,F=Q.indexOf(R),F!==-1&&Q.splice(F,1);return r.return(Q)})},V8o=function(p,l){var Q,H,q,W,c,E,R,F,r;
return g.V(function(d){if(d.B==1)return Q=g.OY("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(d,GB(p,Q,"musicDownloadsLibraryEntity"),2);(H=d.L)||(H={id:Q});q=g.Cu(l).entityType;q==="musicTrack"?(W=H.downloadedTracks)!=null&&W.includes(l)||(H.downloadedTracks=((c=H.downloadedTracks)!=null?c:[]).concat(l)):q==="musicPlaylist"?(E=H.downloadedPlaylists)!=null&&E.includes(l)||(H.downloadedPlaylists=((R=H.downloadedPlaylists)!=null?R:[]).concat(l)):q!=="musicAlbumRelease"||(F=H.downloadedAlbumReleases)!=
null&&F.includes(l)||(H.downloadedAlbumReleases=((r=H.downloadedAlbumReleases)!=null?r:[]).concat(l));return g.S(d,mY(p,H,"musicDownloadsLibraryEntity"),0)})},kJ8=function(p,l){var Q,H,q,W,c,E,R;
return g.V(function(F){if(F.B==1)return Q=g.OY("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(F,GB(p,Q,"musicDownloadsLibraryEntity"),2);H=F.L;if(!H)return F.q3(0);q=g.Cu(l).entityType;q==="musicTrack"?W=H.downloadedTracks:q==="musicPlaylist"&&(W=H.downloadedPlaylists);if((c=W)==null?0:c.length)for(E=0;E<W.length;E++)if(R=W[E],R===l){W.splice(E,1);break}return g.S(F,mY(p,H,"musicDownloadsLibraryEntity"),0)})},uuU=function(p){var l=p.videos;
p=[];var Q=[];if(l){l=g.Z(l);for(var H=l.next();!H.done;H=l.next()){var q=H.value.offlineVideoData.videoId;H=g.OY(q,"musicTrack");q=g.OY(q,"musicTrackDownloadMetadataEntity");p.push(H);Q.push(q)}}return{tF:p,Lu:Q}},S4=function(p,l,Q){l={track:NEJ(l)};
Q&&(l.playlistId=Q);if(p=g.f(p.actionMetadata,Kt8))l.maximumDownloadQuality=p.maximumDownloadQuality;return{musicTrackEntityActionMetadata:l}},Ltb=function(p){var l,Q,H,q,W,c,E,R;
return g.V(function(F){switch(F.B){case 1:return l=g.$M(),Q=LRC(p),H=g.Gq(yY5),g.Yl(F,2),W={P6:!0},g.S(F,g.Uk(l,Q,H,void 0,W),4);case 4:q=F.L;g.ac(F,3);break;case 2:c=g.Ic(F);if(c instanceof g.b4)throw E="GetOffline network manager error: "+c.message,HY(E,c),Error(E);HY("GetOffline fetch request error",c);throw Error("GetOffline fetch request error");case 3:R=Ns(q);if(!q)throw HY("Network request failed"),Error("Network request failed");if(R!==void 0)V8(R);else if(!q.videos||!q.videos.length)throw HY("No data"),
Error("No data");return F.return(q.videos.map(function(r){return r.offlineVideoData}))}})},oYY=function(p){var l,Q,H,q,W,c,E,R;
return g.V(function(F){switch(F.B){case 1:return l=g.$M(),Q=oxK(p),H=g.Gq(yY5),g.Yl(F,2),W={P6:!0},g.S(F,g.Uk(l,Q,H,void 0,W),4);case 4:q=F.L;g.ac(F,3);break;case 2:c=g.Ic(F);if(c instanceof g.b4)throw E="GetOffline network manager error for playlist: "+c.message,HY(E,c),Error(E);HY("GetOffline fetch request error for playlist",c);throw Error("GetOffline fetch request error for playlist");case 3:R=Ns(q);if(!q)throw HY("Network request failed for playlist"),Error("Network request failed for playlist");
if(R!==void 0)V8(R,"playlist");else if(!q.playlists||!q.playlists.length)throw HY("No data for playlist"),Error("No data for playlist");return F.return(q.playlists.map(function(r){return r.offlinePlaylistData}))}})},JYU=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8;
return g.V(function(nW){switch(nW.B){case 1:return g.S(nW,pc(),2);case 2:q=nW.L;if(!q)return nW.return([]);W=[];if((c=H)==null?0:c.length){W=H;nW.q3(3);break}return g.S(nW,it(q,"mainPlaylistEntity"),4);case 4:W=nW.L;case 3:if(!W.length)return nW.return([]);E=[];R=Date.now()/1E3;F=g.Z(W);r=F.next();case 5:if(r.done)return E.length?g.S(nW,AY8(E),10):nW.return([]);d=r.value;if(!d.downloadState){M=void 0;nW.q3(8);break}return g.S(nW,GB(q,d.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:M=
nW.L;case 8:T=M;e=void 0;a=(Y=(e=d)==null?void 0:e.entityMetadata)&&Y.nextAutoRefreshIntervalSeconds?Number(Y.nextAutoRefreshIntervalSeconds):NaN;D=Number.isNaN(a)?p:a;N=X=void 0;u=((X=T)==null?0:X.lastSyncedTimestampMillis)?Number((N=T)==null?void 0:N.lastSyncedTimestampMillis)/1E3:0;iP=J=void 0;C=((J=T)==null?0:J.addedTimestampMillis)?Number((iP=T)==null?void 0:iP.addedTimestampMillis)/1E3:0;if(Q||!Y||u+D<=R){$l=[];Wi=void 0;if((Wi=d.videos)==null?0:Wi.length)for(G=g.Z(d.videos),b=G.next();!b.done;b=
G.next())m=b.value,B=JSON.parse(g.Cu(m).entityId),B.videoId&&$l.push(B.videoId);P="0";Y&&(fW=void 0,P=String(Number((fW=Y.offlineLastModifiedTimestampSeconds)!=null?fW:0).toFixed()));aY={playlistId:d.playlistId,videoIds:$l,offlineLastModifiedTimestamp:P,autoSync:l,offlineDateAddedTimestamp:String(C.toFixed())};E.push(aY)}r=F.next();nW.q3(5);break;case 10:return M8=nW.L,nW.return(M8)}})},faS=function(){var p,l,Q,H,q;
return g.V(function(W){if(W.B==1)return g.S(W,pc(),2);if(W.B!=3)return(p=W.L)?g.S(W,it(p,"refresh"),3):W.return(!1);l=W.L;if((Q=l[0])==null||!Q.refreshTime)return W.return(!1);H=Number(l[0].refreshTime);q=Date.now()/1E3;return W.return(isFinite(H)&&q>=H)})},suY=function(p,l){var Q,H,q;
return g.V(function(W){switch(W.B){case 1:return g.Yl(W,2),g.S(W,gY$(p,l),4);case 4:return H=W.L,g.S(W,BEU(H),5);case 5:Q=hbo(H);g.ac(W,3);break;case 2:q=g.Ic(W),HY("getAndProcessSmartDownloadsResponse request or processing error",q);case 3:return W.return(Q)}})},bDY=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8;
return g.V(function(nW){switch(nW.B){case 1:return g.S(nW,pc(),2);case 2:q=nW.L;if(!q)return nW.return([]);W=[];if((c=H)==null?0:c.length){W=H;nW.q3(3);break}return g.S(nW,it(q,"musicPlaylist"),4);case 4:W=nW.L;case 3:if(!W.length)return nW.return([]);E=[];R=Date.now()/1E3;F=g.Z(W);r=F.next();case 5:if(r.done)return E.length?g.S(nW,AY8(E),10):nW.return([]);d=r.value;M=void 0;e=(T=(M=d)==null?void 0:M.entityMetadata)&&T.nextAutoRefreshIntervalSeconds?Number(T.nextAutoRefreshIntervalSeconds):NaN;Y=
Number.isNaN(e)?p:e;D=a=0;X="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!d.downloadMetadata){nW.q3(8);break}return g.S(nW,GB(q,d.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:N=nW.L,J=u=void 0,a=Number((J=(u=N)==null?void 0:u.addedTimestampMillis)!=null?J:"0")/1E3,C=iP=void 0,D=Number((C=(iP=N)==null?void 0:iP.lastModifiedTimestampMillis)!=null?C:"0")/1E3,Wi=$l=void 0,X=(Wi=($l=N)==null?void 0:$l.syncState)!=null?Wi:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:G=void 0;if(Q||X!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!T||Number((G=T.lastSyncedTimestampSeconds)!=null?G:0)+Y<=R){b=[];m=void 0;if((m=d.tracks)==null?0:m.length)for(B=g.Z(d.tracks),P=B.next();!P.done;P=B.next())fW=P.value,b.push(g.Cu(fW).entityId);aY={playlistId:d.playlistId,videoIds:b,offlineLastModifiedTimestamp:String(D.toFixed()),autoSync:l,offlineDateAddedTimestamp:String(a.toFixed())};E.push(aY)}r=F.next();nW.q3(5);break;case 10:return M8=nW.L,nW.return(M8)}})},gY$=function(p,l){var Q,H,q,W,c,E,R,F,r,d;
return g.V(function(M){switch(M.B){case 1:return Q=g.$M(),g.S(M,pc(),2);case 2:H=M.L;if(!H){M.q3(3);break}return g.S(M,PQJ(H),4);case 4:q=M.L;case 3:var T=q;W={context:g.Oi(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:p},offlineClientState:T,clientStateRequestData:{preferredFormatType:l}}}};c=g.Gq(PYt);g.Yl(M,5);R={P6:!0};return g.S(M,g.Uk(Q,W,c,void 0,R),7);case 7:E=M.L;g.ac(M,6);break;case 5:F=g.Ic(M);if(F instanceof g.b4)throw r=
"DPS network manager error for smart downloads: "+F.message,HY(r,F),Error(r);HY("DPS fetch request error for smart downloads",F);throw Error("DPS fetch request error for smart downloads");case 6:d=Ns(E);if(E)d!==void 0&&V8(d,"smart downloads");else throw HY("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return M.return(E)}})},UEb=function(p,l){var Q,H,q,W,c,E,R,F;
return g.V(function(r){switch(r.B){case 1:return Q=g.$M(),H={context:g.Oi(),videoPlaybackPositionEntities:p,lastSyncTimestampUsec:l},q=g.Gq(xEb),g.Yl(r,2),c={P6:!0},g.S(r,g.Uk(Q,H,q,void 0,c),4);case 4:W=r.L;g.ac(r,3);break;case 2:E=g.Ic(r);if(E instanceof g.b4)throw R="VPPS network manager error: "+E.message,HY(R,E),Error(R);HY("VPPS fetch request error",E);throw Error("VPPS fetch request error");case 3:F=Ns(W);if(W)F!==void 0&&V8(F,"position sync");else throw HY("Network request failed for position sync"),
Error("Network request failed for position sync");return r.return(W)}})},OD8=function(p,l,Q){var H,q,W,c,E,R,F,r;
return g.V(function(d){switch(d.B){case 1:H=g.$M();var M=Q.refreshData,T=Q.isEnqueuedForExpiredStreamUrlRefetch,e=Q.T5,Y=Q.offlineSourceData,a=Q.mediaCapabilities,D={entityKey:p};M&&(D.refreshData=M);T&&(D.isExpiredStreamUrlRefetch=T);e&&(D.downloadParameters=e);Y&&(D.offlineSourceData=Y);M={context:g.Qs(l),signatureTimestamp:20167,videos:[D]};a&&(M.mediaCapabilities=a);q=M;W=g.Gq(CYS);g.Yl(d,2);E={P6:!0};return g.S(d,g.Uk(H,q,W,void 0,E),4);case 4:c=d.L;g.ac(d,3);break;case 2:R=g.Ic(d);if(R instanceof
g.b4)throw F="GetPDE network manager error: "+R.message,HY(F,R),Error(F);HY("GetPDE fetch request error",R);throw Error("GetPDE fetch request error");case 3:r=Ns(c);if(c)r!==void 0&&V8(r,"PDE");else throw HY("Network request failed for PDE"),Error("Network request failed for PDE");return d.return(c)}})},Ns=function(p){var l;
return(l=p.errorMetadata)==null?void 0:l.status},V8=function(p,l){l=l?" for "+l:"";
if(p===0)throw p="Empty response body"+l,HY(p),Error(p);p="Response with error"+l;HY(p);throw Error(p);},AY8=function(p){var l,Q,H,q,W,c,E,R;
return g.V(function(F){switch(F.B){case 1:return l=g.$M(),Q=Awt(p),H=g.Gq(vYo),g.Yl(F,2),W={P6:!0},g.S(F,g.Uk(l,Q,H,void 0,W),4);case 4:q=F.L;g.ac(F,3);break;case 2:c=g.Ic(F);if(c instanceof g.b4)throw E="offlinePlaylistSyncCheck network manager error: "+c.message,HY(E,c),Error(E);HY("offlinePlaylistSyncCheck fetch request error",c);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:R=Ns(q);if(!q)throw HY("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(R!==void 0)V8(R,"playlist sync");else if(!q.offlinePlaylistSyncCheckDatas||!q.offlinePlaylistSyncCheckDatas.length)throw HY("No data for playlist sync"),Error("No data for playlist sync");return F.return(q.offlinePlaylistSyncCheckDatas.map(function(r){return r.offlinePlaylistSyncCheckData}))}})},kP=function(p){this.B=p},mEb=function(p,l){var Q,H,q,W,c,E;
return g.V(function(R){switch(R.B){case 1:Q=new Map,H=g.Z(l),q=H.next();case 2:if(q.done){R.q3(4);break}W=q.value;c=Q;E=c.set;return g.S(R,p.L(W),5);case 5:E.call(c,W,R.L);q=H.next();R.q3(2);break;case 4:return R.return(Q)}})},ut=function(p,l,Q,H,q,W){l=g.OY(l,Q);
H=Object.assign({},W,{priority:H,retryScheduleIntervalsInSeconds:q});return{actionType:p,entityKey:l,actionMetadata:H}},Kc=function(p,l,Q,H,q,W){this.status=p;
this.B=l;this.j=Q;this.L=H;this.X=q;this.downloadState=W},GJ8=function(p,l,Q){this.B=p;
this.lO=l;this.X=Q},lWG=function(p,l){var Q,H,q,W,c,E,R,F,r;
return g.V(function(d){switch(d.B){case 1:return Q=l.entityKey,q=(H=g.f(l.actionMetadata,y8))==null?void 0:H.isEnqueuedForExpiredStreamUrlRefetch,g.Yl(d,2),W=void 0,g.S(d,iCJ(p,l),4);case 4:W=d.L;g.Yl(d,5);var M=(M=g.f(l.actionMetadata,y8))?{maximumDownloadQuality:M.maximumDownloadQuality}:void 0;return g.S(d,OD8(Q,p.lO,{isEnqueuedForExpiredStreamUrlRefetch:q,T5:M,offlineSourceData:W}),7);case 7:c=d.L;g.ac(d,6,2);break;case 5:return g.Ic(d,2),E=Rw(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",HY("PDE handleAdd error"),d.return(Lc(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,"DOWNLOAD_STATE_FAILED"));case 6:return g.S(d,pet(p,c,l),8);case 8:return d.return(Lc(l,!0,c.orchestrationActions));case 2:return R=g.Ic(d),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.jz&&R.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),HY("PDE handleAdd error"),d.return(Lc(l,!1,void 0,F,r,"DOWNLOAD_STATE_FAILED"))}})},HCC=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi;
return g.V(function(G){switch(G.B){case 1:return Q=l.entityKey,H=g.Cu(Q).entityId,g.S(G,vR(p.B,{mode:"readonly",Es:!0},function(b){var m=sV(b,Q,"playbackData"),B=sV(b,g.OY(H,"offlineVideoPolicy"),"offlineVideoPolicy");b=sV(b,g.OY(H,"transfer"),"transfer");return g.Yd.all([m,B,b])}),2);
case 2:q=G.L;W=g.Z(q);c=W.next().value;E=W.next().value;R=W.next().value;F=c;r=E;d=R;if(!F||!r)return G.return(Lc(l,!0));M=[];Y=((e=F)==null?0:e.playerResponseJson)?JSON.parse(F.playerResponseJson):null;if(!(d&&Y&&p.lO.D("html5_refresh_deprecated_downloads"))){G.q3(3);break}T=QnK(p,Y,d);return g.S(G,$v5(p,d),4);case 4:M=G.L;case 3:a={lastPlayerResponseTimestampSeconds:F.playerResponseTimestamp,offlineToken:r.offlineToken,formatIds:M};D={};if((X=d)==null?0:X.maximumDownloadQuality)D.maximumDownloadQuality=
d.maximumDownloadQuality;g.Yl(G,5);N=void 0;return g.S(G,iCJ(p,l),7);case 7:return N=G.L,g.Yl(G,8),g.S(G,OD8(Q,p.lO,{refreshData:a,T5:D,offlineSourceData:N,mediaCapabilities:T}),10);case 10:u=G.L;g.ac(G,9,5);break;case 8:return g.Ic(G,5),J=Rw(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",HY("PDE handleRefresh error"),G.return(Lc(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",J,"DOWNLOAD_STATE_FAILED"));
case 9:return g.S(G,pet(p,u,l),11);case 11:return G.return(Lc(l,!0,u.orchestrationActions));case 5:return iP=g.Ic(G),C="PDE handleRefresh error",iP instanceof Error&&(C="PDE handleRefresh error: "+iP.message),$l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Wi="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",iP instanceof g.jz&&iP.type==="QUOTA_EXCEEDED"&&($l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Wi="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),HY(C),G.return(Lc(l,
!1,void 0,$l,Wi,"DOWNLOAD_STATE_FAILED"))}})},iCJ=function(p,l){var Q,H,q,W;
return g.V(function(c){if(c.B==1)return Q=g.Cu(l.entityKey).entityId,H=g.OY(Q,"videoDownloadContextEntity"),g.S(c,GB(p.B,H,"videoDownloadContextEntity"),2);q=c.L;return(W=q)!=null&&W.offlineModeType?c.return({offlineModeType:q.offlineModeType}):c.return(void 0)})},pet=function(p,l,Q){var H,q,W,c,E;
return g.V(function(R){if(R.B==1){if(!l.frameworkUpdates||!g.f(l.frameworkUpdates,Iw))return R.return();if(!(g.f(l.frameworkUpdates,Iw).mutations&&g.f(l.frameworkUpdates,Iw).mutations.length>0&&g.f(l.frameworkUpdates,Iw).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return R.q3(2);H=g.Cu(g.f(l.frameworkUpdates,Iw).mutations[0].entityKey).entityId;return g.S(R,Db(p.B,H),3)}if(R.B!=2){q=R.L;W=g.f(Q.actionMetadata,y8);if(E=(c=W)==null?void 0:c.playlistId)q.playlistId=E;q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.CI(p.lO)?g.S(R,aw(H,p.B,Q,p.X,q),2):g.ym(p.lO)?g.S(R,nc(H,p.B,Q,p.X),2):R.q3(2)}return g.S(R,wJ8(g.f(l.frameworkUpdates,Iw)),0)})},Lc=function(p,l,Q,H,q,W){return new Kc(l?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Rw(p),Q,H,q,W)},QnK=function(p,l,Q){l=FtK(p.lO,Q.cotn,l);
Q=g.qZ(l);return g.kny(l,Q,p.lO)},$v5=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M;
return g.V(function(T){if(T.B==1)return Q=[],g.S(T,vR(p.B,{mode:"readonly",Es:!0},function(e){var Y=[],a=l.offlineVideoStreams;if(a){a=g.Z(a);for(var D=a.next();!D.done;D=a.next())Y.push(sV(e,D.value,"offlineVideoStreams"))}return g.Yd.all(Y)}),2);
if(H=T.L)for(q=g.Z(H),W=q.next();!W.done;W=q.next())if(c=W.value,E=void 0,(E=c)==null?0:E.streamsProgress)for(R=c.streamsProgress,F=0;F<R.length;F++)r=R[F],d=JSON.parse(r.formatStreamBytes),M={itag:d.itag,lmt:d.lastModified,xtags:d.xtags},Q.push(M);return T.return(Q)})},qat=function(p,l){this.B=p;
this.lO=l},WPY=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T;
return g.V(function(e){switch(e.B){case 1:return Q=Rw(l),g.S(e,it(p.B,"videoPlaybackPositionEntity"),2);case 2:H=e.L;if(H.length===0)return e.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.Yl(e,3);return g.S(e,Jx.getInstance(),5);case 5:q=e.L;if(!q)throw Error("prefStorage is undefined");return g.S(e,q.get("psi"),6);case 6:return W=e.L,R=(E=(c=W)==null?void 0:c.LR)!=null?E:"0",g.S(e,UEb(H,R),7);case 7:return F=e.L,r={isPaused:F.watchHistoryPaused,LR:F.syncTimestampUsec},g.S(e,q.set("psi",
r),8);case 8:if(r.isPaused){e.q3(9);break}d=g.f(F.frameworkUpdates,Iw);if(!F.frameworkUpdates||!d){e.q3(9);break}return g.S(e,wJ8(d),9);case 9:g.ac(e,4);break;case 3:return M=g.Ic(e),T="PPE handleRefresh error: "+(M instanceof Error?M.message:"unknown error"),HY(T),e.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return e.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},tl5=function(p,l){var Q,H,q,W,c,E,R,F;
return g.V(function(r){switch(r.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey).entityId,g.Yl(r,2),g.S(r,Jx.getInstance(),4);case 4:q=r.L;if(!q)throw Error("prefStorage is undefined");return g.S(r,q.get("psi"),5);case 5:W=r.L;c=g.f(l.actionMetadata,c7J);if(((E=W)==null?void 0:E.isPaused)!==!1||(R=c)==null||!R.lastPlaybackPositionSeconds){r.q3(6);break}F={key:g.OY(H,"videoPlaybackPositionEntity"),videoId:H,lastPlaybackPositionSeconds:c.lastPlaybackPositionSeconds};return g.S(r,mY(p.B,F,"videoPlaybackPositionEntity"),
6);case 6:g.ac(r,3);break;case 2:return g.Ic(r),r.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},E_t=function(p,l){var Q,H,q;
return g.V(function(W){switch(W.B){case 1:Q=Rw(l);g.Yl(W,2);H=g.Cu(l.entityKey).entityId;if(H==="!*$_ALL_ENTITIES_!*$")return g.S(W,a_o(p.B),5);q=g.OY(H,"videoPlaybackPositionEntity");return g.S(W,hGb(p.B,q),5);case 5:g.ac(W,3);break;case 2:return g.Ic(W),W.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},R3U=function(p,l){this.api=p;
this.B=l;this.logger=new g.Qu("woffle");this.L=!1;this.tR={I$:this.I$};this.logger.debug("Initialized OfflineMediaManager")},FP$=function(p){return g.V(function(l){return l.return(ywo(p))})},r7K=function(p){var l;
return g.V(function(Q){if(Q.B==1)return g.S(Q,g.HhX(p),2);l=Q.L;return Q.return(l.filter(function(H){return!!H.url}).map(function(H){return H.url}))})},ow=function(p,l){var Q=g.XW(l);
if(Q===1||Q===0)return Promise.resolve();(Q=dv8(p,l))&&Q.stopVideo();p.X=0;return FP$(l)},AU=function(p,l,Q,H){Q=Q===void 0?!1:Q;
H=H===void 0?!0:H;var q=typeof l==="string"?l:l.videoDetails.videoId;g.XW(q)===2&&((l=dv8(p,q))?l.stopVideo():p.logger.info(function(){return"Corresponding player for "+q+" not found. Pausing anyway"}),g.w3(q,2),p.X=2,Q?jnJ(p.B):H&&MlK(p.B))},dv8=function(p,l){var Q;
return((Q=p.player)==null?void 0:Q.getVideoData().videoId)===l?p.player:null},Tq$=function(p,l,Q){l.getPlayerResponse();
g.w3(l.videoId,2);p.X=2;p.L=!1;var H;(H=p.player)==null||H.dispose();p.player=p.api.Fk(l);l={};p.player.jQ((l.localmediachange=p.Dl,l.signatureexpired=p.LI,l.statechange=p.fgL,l),p);var q=p.I$(Q);p.player.DE(g.Qf(q,q,!0,"m"),!1);p.logger.debug(function(){return"Starting headless playback with quality: "+q});
p.player.AO(!1)},e3J=function(p,l){this.B=p;
this.lO=l},ZCb=function(p,l){var Q,H;
return g.V(function(q){switch(q.B){case 1:return Q=Rw(l),g.S(q,GB(p.B,l.entityKey,"transfer"),2);case 2:if(H=q.L)return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.Yl(q,3);return g.S(q,z3G(p,l),5);case 5:g.ac(q,4);break;case 3:return g.Ic(q),q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},BqJ=function(p,l){var Q,H;
return g.V(function(q){switch(q.B){case 1:return Q=Rw(l),g.S(q,GB(p.B,l.entityKey,"transfer"),2);case 2:H=q.L;if(!H||H.transferState!=="TRANSFER_STATE_COMPLETE")return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.Yl(q,3);return g.S(q,z3G(p,l,!0),5);case 5:g.ac(q,4);break;case 3:return g.Ic(q),q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},Yat=function(p,l){var Q,H,q,W,c,E,R,F,r,d;
return g.V(function(M){switch(M.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey).entityId,g.S(M,vR(p.B,{mode:"readonly",Es:!0},function(T){var e=sV(T,l.entityKey,"transfer");T=sV(T,g.OY(H,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Yd.all([e,T])}),2);
case 2:q=M.L;W=g.Z(q);c=W.next().value;E=W.next().value;R=c;F=E;if(!R||R.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return M.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.Yl(M,3);R.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.S(M,mY(p.B,R,"transfer"),5);case 5:r=g.Cu(R.key).entityId;E3({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:r,tq:R,offlineModeType:(d=F)==null?void 0:d.offlineModeType});g.ac(M,
4);break;case 3:return g.Ic(M),M.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},z3G=function(p,l,Q){Q=Q===void 0?!1:Q;
var H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D;return g.V(function(X){switch(X.B){case 1:return H=g.f(l.actionMetadata,h3o),q=g.Cu(l.entityKey).entityId,W=g.OY(q,"downloadStatusEntity"),g.S(X,vR(p.B,{mode:"readonly",Es:!0},function(N){var u=sV(N,W,"downloadStatusEntity");N=sV(N,g.OY(q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Yd.all([u,N])}),2);
case 2:return c=X.L,E=g.Z(c),R=E.next().value,F=E.next().value,r=R,d=F,M="TRANSFER_STATE_TRANSFER_IN_QUEUE",((T=r)==null?void 0:T.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(M="TRANSFER_STATE_PAUSED_BY_USER"),a={key:l.entityKey,transferState:M,cotn:g.h3(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(e=H)==null?void 0:e.maximumDownloadQuality,preferredAudioTrack:(Y=H)==null?void 0:Y.preferredAudioTrack,transferRetryCount:0,isRefresh:Q,hasLoggedFirstStarted:!1},g.S(X,vR(p.B,
{mode:"readwrite",Es:!0},function(N){var u=[];Q&&u.push(UV(N,g.OY(q,"offlineVideoStreams")));u.push(x8(N,a,"transfer"));return g.Yd.all(u)}),3);
case 3:if(!Q){X.q3(4);break}return g.S(X,FP$(q),4);case 4:E3({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:q,tq:a,offlineModeType:(D=d)==null?void 0:D.offlineModeType}),g.Bi(X)}})},IW5=function(p,l,Q,H){if(!p.action.entityKey)throw Error("entityKey is missing.");
var q=g.Cu(p.action.entityKey);q={entityType:q.lQ,entityId:q.entityId,offlineOrchestrationActionType:p.action.actionType,orchestrationAction:{orchestrationActionId:p.actionId}};l&&(q.offlineOrchestrationActionResult=l.status,q.isRetryable=Q?!1:l.B,l.X&&(q.offlineOrchestrationFailureReason=aWJ(l.X,q.isRetryable)));var W,c;if((W=p.action.actionMetadata)==null?0:(c=W.offlineLoggingData)==null?0:c.offlineModeType)q.offlineModeType=p.action.actionMetadata.offlineLoggingData.offlineModeType;H&&(q.additionalOrchestrationActions=
H.map(function(E){return{orchestrationActionId:E.actionId}}));
return q},aWJ=function(p,l){return p!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||l?p==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&l?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":p:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},DvS=function(p,l){var Q={offlineOrchestrationContext:IW5(p)};
l=soU(l,Q);b1U(gxG(),l,p.rootActionId)},n_o=function(p,l,Q,H){H=H===void 0?[]:H;
l={offlineOrchestrationContext:IW5(p,l,Q,H)};l=soU(3,l);b1U(gxG(),l,p.rootActionId)},Xeo=function(){this.actions=[]},wet=function(p,l){l=g.Z(l);
for(var Q=l.next();!Q.done;Q=l.next())Q=Q.value,DvS(Q,1),p.actions.push(Q);p.actions.sort(p.B)},SaY=function(p,l){if(l)for(var Q=0;Q<p.actions.length;Q++)if(l==="!*$_ALL_ENTITIES_!*$"&&p.actions[Q].actionId!==l||l!=="!*$_ALL_ENTITIES_!*$"&&p.actions[Q].rootActionId===l&&p.actions[Q].actionId!==l)p.actions.splice(Q,1),Q--},NqY=function(p,l){p=g.Z(p.actions);
for(var Q=p.next();!Q.done;Q=p.next())if(Q.value.actionId===l)return!0;return!1},JU=function(p,l,Q,H,q){g.L.call(this);
var W=this;this.L=p;this.uO=l;this.HL=Q;this.S=H;this.lO=q;this.B=new Xeo;this.C=new g.U6;this.X=new g.x_(function(){W.retry()});
this.T=NaN;this.W=!1;this.tR={aBi:function(){return W.B},
PU:function(){return W.C},
Sam:function(){return W.X},
retry:function(){return W.retry()}};
g.A(this,this.X);this.Y=this.L.observe(this.yQ.bind(this))},u2$=function(p,l,Q,H,q){var W;
return g.V(function(c){if(c.B==1)return W=new JU(p,l,Q,H,q),g.S(c,Vlt(W),2);k1S(W);return c.return(W)})},k1S=function(p){var l=p.B.actions[0];
return p.j?((l==null?void 0:l.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.j[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.W=!0),Promise.resolve()):KPb(p)},KPb=function(p){var l,Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D;
return g.V(function(X){switch(X.B){case 1:if(p.j)throw Error("Already processing an action");if(p.vL())return X.return();l=p.B.actions.shift();$EG(p.HL,!l);if(l===void 0)return X.return();l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&l.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&SaY(p.B,l.actionId);Q="";l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.rootActionId===l.actionId&&(Q=l.actionId);H=[l];p.j=H;if(q=p.uO[l.entityType]){X.q3(2);break}p.j=
void 0;return g.S(X,KPb(p),3);case 3:return X.return();case 2:W=g.Z(H);for(c=W.next();!c.done;c=W.next())E=c.value,DvS(E,2);g.Yl(X,4,5);return g.S(X,mEb(q,H.map(function(N){return N.action})),7);
case 7:R=X.L,F=g.Z(H),r=F.next();case 8:if(r.done){X.q3(10);break}d=r.value;M=R.get(d.action);return g.S(X,y7S(p,d,M),9);case 9:r=F.next();X.q3(8);break;case 10:SaY(p.B,Q);case 5:g.DP(X);p.j=void 0;g.XL(X,6);break;case 4:return T=g.Ic(X),HY("Orchestration error",T),g.Yl(X,12),g.S(X,LP$(p,H),14);case 14:g.ac(X,5);break;case 12:e=g.Ic(X);HY("Orchestration retry error",e);Y=g.Z(H);for(a=Y.next();!a.done;a=Y.next())D=a.value,D.retryScheduleIndex<3&&wet(p.B,[D]);X.q3(5);break;case 6:return g.S(X,KPb(p),
0)}})},y7S=function(p,l,Q){var H,q,W,c,E,R,F,r,d,M,T,e;
return g.V(function(Y){switch(Y.B){case 1:H=l.retryScheduleIndex+2===3;if(Q.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Y.q3(2);break}if(Q.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Y.q3(0);break}n_o(l,Q,H);if(Q.B&&l.retryScheduleIndex+1<3)return g.S(Y,LP$(p,[l]),0);W=((q=Q)==null?0:q.L)?Q.L:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";c={entityKey:l.action.entityKey,failureReason:W};E=void 0;g.CI(p.lO)?E="mainVideoDownloadStateEntity":g.ym(p.lO)&&(E="musicTrackDownloadMetadataEntity");
if(!E||!Q.downloadState){Y.q3(7);break}R=g.Cu(l.action.entityKey).entityId;return g.S(Y,j4(R,E,p.L,Q.downloadState),7);case 7:WY(p.S,c);if(Q.downloadState==="DOWNLOAD_STATE_FAILED"&&p.lO.D("html5_auto_retry_failed_pde_actions")){Y.q3(0);break}HY("Orchestration result is not retryable, deleting action");return g.S(Y,hGb(p.L,BY(l).key),0);case 2:F=void 0;try{F=(r=Q.j)==null?void 0:r.map(function(a){return p.createAction(a,l)})}catch(a){return n_o(l,Q,H),d={entityKey:l.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},WY(p.S,d),HY("Orchestration subactions creation error",a),Y.return()}n_o(l,Q,H,F);if(!F){Y.q3(12);break}M=F.map(function(a){return BY(a)});
T=0;case 13:if(!(T<F.length)||p.W){Y.q3(15);break}return g.S(Y,vR(p.L,{mode:"readwrite",Es:!0},function(a){var D=[];D.push(rwY(a,M.slice(T,T+10),"offlineOrchestrationActionWrapperEntity"));return g.Yd.all(D)}),16);
case 16:T+=10;Y.q3(13);break;case 15:if(p.W)return p.W=!1,Y.return();case 12:return e=BY(l),g.S(Y,hGb(p.L,e.key),17);case 17:DvS(l,4),g.Bi(Y)}})},fWY=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T;
return g.V(function(e){Q=[];H=Infinity;q=4E3;W=g.Z(l);for(c=W.next();!c.done;c=W.next())E=c.value,R=Number(E.enqueueTimeSec),F=o_K(R),r=E.retryScheduleIndex,d=r!=null&&r>0,F>0&&d?(H=Math.min(H,R),q=Math.min(F,q)):Q.push(E);isFinite(H)&&(!p.X.isActive()||H<p.T)&&(p.T=H,p.X.start(q));p.C.qp()||(M=Q.length,Q=Q.filter(function(Y){var a;Y=((a=Y.actionProto)==null?void 0:a.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!A78.includes(Y)}),T=Q.length<M,!p.X.isActive()&&T&&p.X.start(1));
Q.length>0&&J78(p,Q);return g.S(e,k1S(p),0)})},snY=function(p){var l,Q,H,q,W,c,E;
return g.V(function(R){if(R.B==1)return g.S(R,g_K(p),2);l=R.L;Q=[];H=g.Z(l);for(q=H.next();!q.done;q=H.next())W=q.value,c=g.Cu(W.key),E=c.entityId,NqY(p.B,E)||Q.push(W);return g.S(R,fWY(p,Q),0)})},o_K=function(p){p=p*1E3-Date.now();
return p>4E3?4E3:p},LP$=function(p,l){var Q,H,q;
return g.V(function(W){Q=g.Z(l);for(H=Q.next();!H.done;H=Q.next()){q=H.value;var c=void 0,E=void 0,R=((E=q.action)==null?void 0:(c=E.actionMetadata)==null?void 0:c.retryScheduleIntervalsInSeconds)||[1,2,4];c=1;q.retryScheduleIndex<R.length&&(c=R[q.retryScheduleIndex]);q.B=c*1E3+Date.now();q.retryScheduleIndex++}return g.S(W,bC8(p,l),0)})},Vlt=function(p){var l;
return g.V(function(Q){if(Q.B==1)return g.S(Q,it(p.L,"offlineOrchestrationActionWrapperEntity"),2);l=Q.L;return g.S(Q,fWY(p,l),0)})},J78=function(p,l){l.length!==0&&l.forEach(function(Q){Q=Zb(Q);
Q.retryScheduleIndex<3&&wet(p.B,[Q])})},g_K=function(p,l){var Q;
return g.V(function(H){if(H.B==1)return g.S(H,it(p.L,"offlineOrchestrationActionWrapperEntity",l),2);Q=H.L;return H.return(Q.filter(SMo))})},bC8=function(p,l){if(l.length===0)return Promise.resolve([]);
l=l.map(function(Q){return BY(Q)});
return YM8(p.L,l)},P6o=function(p){this.fK=p;
this.B=void 0},xvt=function(p,l){var Q,H,q,W;
return g.V(function(c){Q=l.videoId;H=!0;if(l.captionTracks.length)q=t_K(l),p.B=new g.Bn(p.fK,l,q);else if(l.SS)W=g.duP(l),p.B=new g.hd(p.fK,l.SS,Q,W,l.Qk,l.eventId),H=l.Qk;else return c.return();return c.return(new Promise(function(E){var R;(R=p.B)==null||R.Lz({zR:function(){return g.V(function(F){if(F.B==1)return g.S(F,p.zR(Q,H),2);E();g.Bi(F)})},
Bc:function(){}})}))})},UvC=function(p){var l;
return g.V(function(Q){if(Q.B==1)return g.S(Q,KRY(p),2);l=Q.L;return Q.return(!!l&&l.length>0)})},fc=function(p){g.L.call(this);
this.B=p;this.L=this.B.observe(this.X.bind(this))},C6t=function(p,l){var Q,H,q,W,c,E,R;
return g.V(function(F){switch(F.B){case 1:if(l.length===0)return F.return([]);Q=l.map(function(r){return g.OY(r,"transfer")});
return g.S(F,it(p.B,"transfer",Q),2);case 2:H=F.L;q=H.filter(SMo).map(function(r){return g.Cu(r.key).entityId});
W=l.filter(function(r){return q.indexOf(r)===-1});
if(W.length===0)return F.return([]);c=g.Z(W);E=c.next();case 3:if(E.done){F.q3(5);break}R=E.value;return g.S(F,FP$(R),4);case 4:E=c.next();F.q3(3);break;case 5:return F.return(W)}})},mvo=function(p,l,Q,H,q,W){var c,E,R;
return g.V(function(F){c="STREAM_TYPE_UNKNOWN";Q.video&&Q.audio?(c="STREAM_TYPE_AUDIO_AND_VIDEO",HY("unexpected stream type")):Q.video&&!Q.audio?c="STREAM_TYPE_VIDEO":!Q.video&&Q.audio&&(c="STREAM_TYPE_AUDIO");E=g.OY(l,"offlineVideoStreams");R={numBytesDownloaded:q.toFixed(),numTotalBytes:W.toFixed(),streamType:c,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(H),itag:c==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Q.itag):void 0};return g.S(F,vR(p,{mode:"readwrite",Es:!0},
function(r){var d=sV(r,E,"offlineVideoStreams"),M=sV(r,g.OY(l,"transfer"),"transfer");return g.Yd.all([d,M]).then(function(T){T=g.Z(T);var e=T.next().value;T=T.next().value;if(!T)return UV(r,E).then(function(){});
var Y=OCY(e);e=v_5(e,H,R,E);var a=x8(r,e,"offlineVideoStreams");OCY(e)>Y&&(T.lastProgressTimeMs=Date.now().toString());Y=[a];T.offlineVideoStreams||(T.offlineVideoStreams=[]);T.offlineVideoStreams.indexOf(E)===-1&&(T.offlineVideoStreams.push(E),Y.push(x8(r,T,"transfer")));return g.Yd.all(Y)})}),0)})},G1o=function(p,l){var Q,H,q,W,c;
return g.V(function(E){if(E.B==1)return Q=g.OY(l,"offlineVideoStreams"),g.S(E,GB(p,Q,"offlineVideoStreams"),2);H=E.L;if(!H||!H.streamsProgress)return E.return();q=g.Z(H.streamsProgress);for(W=q.next();!W.done;W=q.next())c=W.value,c.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",c.numTotalBytes!==c.numBytesDownloaded&&(c.numBytesDownloaded=c.numTotalBytes);return g.S(E,mY(p,H,"offlineVideoStreams"),0)})},v_5=function(p,l,Q,H){if(p&&p.streamsProgress){H=p;
a:{l=l.itag+";"+l.xtags;for(var q=p.streamsProgress,W=0;W<q.length;W++){var c=JSON.parse(q[W].formatStreamBytes);if(c.itag+";"+c.xtags===l){q[W]=Q;Q=q;break a}}q.push(Q);Q=q}H.streamsProgress=Q}else p={key:H,streamsProgress:[Q]};return p},OCY=function(p){if(p==null?0:p.streamsProgress){var l=0;
p=p.streamsProgress;for(var Q=0;Q<p.length;Q++){var H=p[Q];isNaN(Number(H.numBytesDownloaded))?HY("stream progress bytes number invalid"):l+=Number(H.numBytesDownloaded)}return l}return 0},iSS=function(p,l,Q,H){g.L.call(this);
var q=this;this.L=p;this.api=l;this.IG=Q;this.yQ=H;this.C=new g.U6;this.j=new g.x_(function(){q.B&&q.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&q.C.qp()&&((q.B.transferRetryCount||0)<3?AU(q.S,q.W,!1,!1):ow(q.S,q.W.videoDetails.videoId),q.I2("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.HL=this.KK=0;this.Y=this.T=!1;this.ZD=g.E7(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.aG=new g.kg(this);this.tR={mvQ:function(){return q.j},
qaj:function(){return q.yQ},
PU:function(){return q.C}};
this.uO=this.L.observe(this.J7.bind(this));this.S=new R3U(l,this);this.ej=new P6o(l);this.JP=new fc(this.L);this.ON=this.C.listen("publicytnetworkstatus-online",this.jb.bind(this));this.QQ=this.C.listen("publicytnetworkstatus-offline",this.PMQ.bind(this));this.Y=this.api.U().D("html5_less_transfer_processing_logs");g.A(this,this.aG);this.aG.Z(l,"offlinetransferpause",this.Bjj);g.CI(this.api.U())?this.X="mainVideoDownloadStateEntity":g.ym(this.api.U())&&(this.X="musicTrackDownloadMetadataEntity")},
pFS=function(p){return g.V(function(l){if(l.B==1)l=g.S(l,kK8(),2);
else{var Q=p.JP;var H=g.np();H=Object.keys(H);Q=C6t(Q,H);l=g.S(l,Q,0)}return l})},s3=function(p,l){l=l===void 0?!1:l;
var Q;return g.V(function(H){if(H.B==1){if(p.B)throw Error("Already downloading a video");p.HL=0;p.T=!1;return g.S(H,lpC(p),2)}return H.B!=4?(Q=H.L,HDK(p.IG,!Q),Q&&p.C.qp()?l?g.S(H,new Promise(function(q){g.dp(q,1E3)}),4):H.q3(4):(!Q&&p.B&&gm(p),H.q3(0))):g.S(H,QRY(p,Q),0)})},$AG=function(p){return g.V(function(l){if(l.B==1)return p.W?g.S(l,ow(p.S,p.W.videoDetails.videoId),3):l.q3(0);
gm(p);g.Bi(l)})},HSY=function(p,l){var Q,H,q;
return g.V(function(W){switch(W.B){case 1:return g.Yl(W,2),(Q=!!l.captionTracks.length||!!l.SS)?g.S(W,UvC(l.videoId),4):W.return();case 4:return(H=W.L)?W.return():g.S(W,xvt(p.ej,l),5);case 5:g.ac(W,0);break;case 2:q=g.Ic(W),HY("Caption downloading error",q,l.cotn),g.Bi(W)}})},QRY=function(p,l){var Q,H,q,W,c,E;
return g.V(function(R){switch(R.B){case 1:if(p.T)return R.return();p.T=!0;p.B=l;Q=g.Cu(p.B.key);H=Q.entityId;q=void 0;if(p.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.S(R,bt(p,H),7);if(p.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||p.B.transferRetryCount||p.B.hasLoggedFirstStarted){R.q3(3);break}return g.S(R,bt(p,H),5);case 5:return q=R.L,p.B.hasLoggedFirstStarted=!0,g.S(R,q2Y(p),6);case 6:qIb({videoId:H,tq:p.B,offlineModeType:q},void 0,void 0,!0);R.q3(3);break;case 7:q=R.L,
E3({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:H,tq:p.B,offlineModeType:q});case 3:return g.S(R,W05(p),8);case 8:return W=null,g.Yl(R,9),g.S(R,cmU(p,l),11);case 11:W=R.L;p.W=W;g.ac(R,10);break;case 9:return c=g.Ic(R),HY("error getting player response",c,l.cotn),g.S(R,p.I2("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return R.return();case 10:return E=FtK(p.api.U(),l.cotn,W),g.S(R,HSY(p,E),13);case 13:return g.S(R,r7K(E.videoId),
14);case 14:E.rC=R.L,Tq$(p.S,E,l.maximumDownloadQuality),p.j.start(108E5),g.Bi(R)}})},lpC=function(p){var l,Q;
return g.V(function(H){if(H.B==1)return g.S(H,it(p.L,"transfer"),2);l=H.L;Q=l.filter(tk5).sort(EvY);return Q.length===0?H.return():H.return(Q[0])})},W05=function(p){var l,Q,H;
return g.V(function(q){if(q.B==1){if(!p.B)return PY(p,"onTransferStart"),q.return();p.j.start(108E5);return g.S(q,xP(p,"TRANSFER_STATE_TRANSFERRING"),2)}l=p.B;return(H=((Q=l)==null?0:Q.key)?g.Cu(l.key).entityId:"")&&p.X?g.S(q,j4(H,p.X,p.L,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):q.q3(0)})},jnJ=function(p){var l,Q,H,q;
g.V(function(W){switch(W.B){case 1:if(!p.B){PY(p,"onTransferPausedByUser");W.q3(2);break}l=p.B;p.j.stop();return g.S(W,xP(p,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:H=((Q=l)==null?0:Q.key)?g.Cu(l.key).entityId:"";if(!H||!p.X){W.q3(4);break}return g.S(W,j4(H,p.X,p.L,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.S(W,bt(p,H),6);case 6:q=W.L,WtJ({videoId:H,tq:l,offlineModeType:q});case 2:gm(p),s3(p),g.Bi(W)}})},MlK=function(p){var l,Q,H;
g.V(function(q){if(q.B==1){if(!p.B)return PY(p,"onTransferPausedByNetwork"),q.return();p.j.stop();return g.S(q,xP(p,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(q.B!=3)return l=p.B,(H=((Q=l)==null?0:Q.key)?g.Cu(l.key).entityId:"")&&p.X?g.S(q,j4(H,p.X,p.L,"DOWNLOAD_STATE_PAUSED"),3):q.q3(3);gm(p);g.Bi(q)})},RWJ=function(p){var l,Q,H,q,W;
g.V(function(c){switch(c.B){case 1:if(!p.B)return PY(p,"onTransferComplete"),c.return();l=p.B;p.j.stop();if(!l||!p.W){c.q3(2);break}Q=FtK(p.api.U(),l.cotn,p.W);return g.S(c,HSY(p,Q),2);case 2:return g.S(c,xP(p,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:q=((H=l)==null?0:H.key)?g.Cu(l.key).entityId:"";if(!q||!p.X){c.q3(5);break}return g.S(c,j4(q,p.X,p.L,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.S(c,G1o(p.L,q),7);case 7:return g.S(c,bt(p,q),8);case 8:W=c.L,E3({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:q,tq:l,offlineModeType:W}),gm(p),s3(p),g.Bi(c)}})},F0Y=function(p,l,Q){var H,q;
g.V(function(W){switch(W.B){case 1:if(!p.B)return PY(p,"onTransferProgress: "+l),W.return();if(p.B.transferState==="TRANSFER_STATE_TRANSFERRING"){W.q3(2);break}return g.S(W,W05(p),2);case 2:H=Date.now();if(!(H-p.KK>1E3)){W.q3(4);break}p.KK=H;return g.S(W,mvo(p.L,Q.videoId,Q.L,Q.qQ,Q.bytesDownloaded,Q.B),5);case 5:if(p.Y&&!(p.Y&&H-p.HL>p.ZD)){W.q3(4);break}p.HL=H;return g.S(W,bt(p,l),7);case 7:q=W.L,qIb({videoId:l,tq:p.B,offlineModeType:q},Q.bytesDownloaded,Q.B);case 4:p.j.start(108E5),g.Bi(W)}})},
rmY=function(p){var l=(p.B.transferRetryCount||0)<3;
l&&(p=p.B,p.transferRetryCount=(p.transferRetryCount||0)+1);return l},dAK=function(p,l){l=l===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":l;
var Q,H,q,W;return g.V(function(c){if(c.B==1)return p.B||PY(p,"setTransferToFailed: "+l),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l==="TRANSFER_FAILURE_REASON_NETWORK"?Q="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":l==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.S(c,xP(p,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",l),2);if(c.B!=3)return WY(p.yQ,{entityKey:(H=p.B)==null?void 0:H.key,failureReason:Q}),
q=p.B?g.Cu(p.B.key).entityId:"",g.S(c,bt(p,q),3);W=c.L;var E={videoId:q,tq:p.B,offlineModeType:W},R=l,F={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};R&&(F.transferFailureReason=R,F.failureReason=cY8(R));E3(F,E);g.Bi(c)})},xP=function(p,l,Q,H){var q;
return g.V(function(W){if(W.B==1){if(!p.B)return PY(p,"saveTransferState: "+l),W.return();p.B.transferState=l;p.B.failureReason=H;g.Yl(W,2);return g.S(W,q2Y(p,function(c){return Q?bB(c,"offlineVideoStreams",p.B.offlineVideoStreams).then(function(E){for(var R=g.Z(E),F=R.next();!F.done;F=R.next())if((F=F.value)&&F.streamsProgress){F=g.Z(F.streamsProgress);for(var r=F.next();!r.done;r=F.next())r.value.streamState=Q}return rwY(c,E.filter(function(d){return!!d}),"offlineVideoStreams")}):g.Yd.resolve(void 0)}),
4)}if(W.B!=2)return g.ac(W,0);
q=g.Ic(W);return q instanceof g.jz&&q.type==="QUOTA_EXCEEDED"?g.S(W,p.I2("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):W.q3(0)})},q2Y=function(p,l){var Q;
return g.V(function(H){if(!p.B)return H.return();Q=p.B;return g.S(H,vR(p.L,{mode:"readwrite",Es:!0},function(q){var W=[x8(q,Q,"transfer")];l&&W.push(l(q));return g.Yd.all(W)}),0)})},gm=function(p){p.B=void 0;
p.W=void 0;p.j.stop()},cmU=function(p,l){var Q,H,q,W,c;
return g.V(function(E){if(E.B==1)return Q=g.Cu(l.key),H=Q.entityId,q=g.OY(H,"playbackData"),g.S(E,GB(p.L,q,"playbackData"),2);W=E.L;if((c=W)==null?0:c.playerResponseJson)return E.return(JSON.parse(W.playerResponseJson));throw Error("No PlayerResponse found");})},PY=function(p,l){p.api.BL("woffle",{mcte:l});
HY("missing current transfer entity.")},bt=function(p,l){var Q,H,q;
return g.V(function(W){if(W.B==1)return g.S(W,GB(p.L,g.OY(l,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Q=W.L;return W.return((q=(H=Q)==null?void 0:H.offlineModeType)!=null?q:void 0)})},tk5=function(p){return jR$[p.transferState]!==void 0},EvY=function(p,l){var Q=jR$[p.transferState],H=jR$[l.transferState];
return Q!==H?Q-H:Number(p.enqueuedTimestampMs)-Number(l.enqueuedTimestampMs)},U3=function(p,l){var Q=this;
this.lO=p;this.api=l;this.C=new g.U6;this.W=new g.h$;this.tR={rQ:function(){return Q.X.tR.rQ()},
PU:function(){return Q.C},
C7m:function(){return Q.X},
Ut:function(){return Q.Ut()},
yx:function(){return Q.yx()},
XD:function(){return Q.XD()},
sf:function(){return Q.sf()},
W9:function(){return Q.W9()},
Am:function(H){return Q.Am(H)}};
this.X=new puo(function(){return MkY(Q)},function(){Q.XD()},this.api.Dn(),this.api.D.bind(this.api));
this.B=new qs(this.api);lao(this.X)},MkY=function(p){return g.V(function(l){p.api.bO("onOrchestrationBecameLeader");
return g.S(l,p.yx(),0)})},eWb=function(p){var l,Q;
return g.V(function(H){if(H.B==1)return g.S(H,pc(),2);if(H.B!=3){l=H.L;if(!l)return HY("PES is undefined"),H.return();p.L=new iSS(l,p.api,p.X,p.B);Q=p.Gl(l);return g.S(H,u2$(l,Q,p.X,p.B,p.lO),3)}p.S=H.L;return g.S(H,TMY(p),0)})},TMY=function(p){var l;
return g.V(function(Q){switch(Q.B){case 1:if(!p.L)return HY("transferManager is undefined"),Q.return();if(p.L.B){Q.q3(2);break}return g.S(Q,s3(p.L),2);case 2:if(!p.lO.D("woffle_enable_main_downloads_library")){Q.q3(4);break}return g.S(Q,p.LM(),4);case 4:if(!p.lO.D("html5_offline_playback_position_sync")){Q.q3(6);break}return g.S(Q,p.qX(),7);case 7:return g.S(Q,p.Am(864E5),6);case 6:return g.S(Q,p.refreshAllStaleEntities(43200,!0),9);case 9:return g.S(Q,p.pU(),10);case 10:if(!p.lO.D("html5_retry_downloads_for_expiration")){Q.q3(11);
break}return g.S(Q,p.W9(),11);case 11:return p.T=g.Mt(function(){p.refreshAllStaleEntities(43200,!0);p.pU()},9E5),g.vs(g.GM(),function(){return p.sf()}),g.S(Q,pc(),13);
case 13:return l=Q.L,g.S(Q,iDo(l),14);case 14:Quo(p.X),g.Bi(Q)}})},zW5=function(){var p,l,Q,H,q,W;
return g.V(function(c){switch(c.B){case 1:return g.S(c,pc(),2);case 2:p=c.L;if(!p)return c.return([]);l=Date.now()/1E3;return g.S(c,it(p,"offlineVideoPolicy"),3);case 3:Q=c.L,H=g.Z(Q),q=H.next();case 4:if(q.done){c.q3(6);break}W=q.value;if(!(W.expirationTimestamp&&Number(W.expirationTimestamp)<l)){c.q3(5);break}W.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";W.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.S(c,mY(p,W,"offlineVideoPolicy"),5);
case 5:q=H.next();c.q3(4);break;case 6:return c.return(Q.map(function(E){return E.key}))}})},Cc=function(p,l,Q,H,q){var W,c,E;
return g.V(function(R){if(R.B==1)return g.S(R,pc(),2);W=R.L;if(!W)return R.return([]);c=l.map(function(F){var r=g.OY(F,Q);r={actionType:H,entityKey:r,actionMetadata:Object.assign({},rYJ(),q)};H!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(r.actionMetadata.priority=0);F=new zV(Q,F,r);return BY(F)});
E=YM8(W,c);lao(p.X);return R.return(E)})},ZSU=function(p,l,Q,H){var q,W,c,E,R,F,r,d;
return g.V(function(M){switch(M.B){case 1:q=[],W=g.Z(l),c=W.next();case 2:if(c.done){M.q3(4);break}E=c.value;if(E.upToDate||Q&&!E.shouldAutoSyncMetadata||!E.playlistId){M.q3(3);break}R={};switch(H){case "mainPlaylistEntity":F={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:Q};R={mainPlaylistEntityActionMetadata:F};break;case "musicPlaylist":r={autoSync:Q},R={musicPlaylistEntityActionMetadata:r}}return g.S(M,Cc(p,[E.playlistId],H,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",R),6);case 6:(d=
M.L)&&q.push.apply(q,g.h(d));case 3:c=W.next();M.q3(2);break;case 4:return M.return(q)}})},BM$=function(p,l){var Q;
return g.V(function(H){return l.length?(Q=rYJ(),g.Jc(Q,y8,{isEnqueuedForExpiredStreamUrlRefetch:!0}),p.api.BL("qrd",{v:l.length}),H.return(Cc(p,l,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q))):H.return([])})},Y2o=function(p,l,Q){this.B=p;
this.lO=l;this.X=Q},IpY=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X;
return g.V(function(N){switch(N.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,W=[],g.Yl(N,2),g.S(N,hWU(p,q),4);case 4:W=N.L;if(!(p.lO.D("woffle_enable_main_downloads_library")&&((c=W)==null?0:c.length))){N.q3(5);break}return g.S(N,DE8(p.B,[l.entityKey]),5);case 5:g.ac(N,3);break;case 2:return E=g.Ic(N),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.jz&&E.type==="QUOTA_EXCEEDED"?(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):HY("Playlist add error"),N.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,R,F));case 3:r=[];if(!p.lO.D("html5_offline_prevent_redownload_downloaded_video")){N.q3(7);break}return g.S(N,Rb8(p.B,"mainVideoEntity",W),8);case 8:W=N.L;case 7:if((d=W)==null?0:d.length)for(M=g.Z(W),T=M.next();!T.done;T=M.next())if(e=T.value,Y=e.offlineVideoData,a=void 0,(a=Y)==null?0:a.videoId)D=void 0,X=Number(((D=l.actionMetadata)==null?void 0:D.priority)||
0)+1,r.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"mainVideoEntity",X,O3,ap8(l,Y,q)));return N.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,r))}})},nvC=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et,I,n,w,k,y,pW,Hi,qr,K,Rc,T$,tg,Nr,TU,JS,jC,xl,fq,Ew,KV,PO,Fy,P2,gP,xu,Yu,rQ,Ne,jn,Vp,gB,s9,I2,iR,Uh,Hh,VB,Cw;
return g.V(function(My){switch(My.B){case 1:return Q=Rw(l),H=l.entityKey,q=g.Cu(H).entityId,W=[],c=!1,q==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.S(My,it(p.B,"mainPlaylistEntity"),5)):g.S(My,GB(p.B,H,"mainPlaylistEntity"),4);case 4:(E=My.L)&&W.push(E);My.q3(3);break;case 5:W=My.L;case 3:if((R=W)==null||!R.length)return My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));F=g.f(l.actionMetadata,DA5);d=(r=F)==null?void 0:r.nextAutoRefreshIntervalSeconds;T=(M=F)==null?void 0:M.autoSync;e=[];a=Y=
!0;D=!1;if(!c&&T===!1){My.q3(6);break}g.Yl(My,7);return g.S(My,JYU(0,!!T,!0,W),9);case 9:e=My.L;g.ac(My,8);break;case 7:X=g.Ic(My);if(!(X instanceof Error&&X.message==="No data")){X instanceof Error&&X.message==="Empty response body"&&HY(X.message);My.q3(8);break}return q==="!*$_ALL_ENTITIES_!*$"?g.S(My,ZDY(p.B,l,p.X,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.S(My,ebJ(q,p.B,l,p.X),8);case 8:if(!e.length||!c&&e[0].playlistId!==q)return My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));case 6:if(c){N=[];u=g.Z(e);for(J=u.next();!J.done;J=u.next())iP=J.value,iP.upToDate||T&&!iP.shouldAutoSyncMetadata||!iP.playlistId||(C={nextAutoRefreshIntervalSeconds:iP.checkInSeconds,autoSync:T},N.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",iP.playlistId,"mainPlaylistEntity",0,O3,{mainPlaylistEntityActionMetadata:C})));return My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,N))}e.length&&($l=e[0],D=!!$l.upToDate,T&&(Y=(Wi=$l.shouldAutoSyncMetadata)!=null?Wi:!0,a=(G=$l.shouldAutoSyncVideos)!=
null?G:!0,$l.checkInSeconds&&(d=$l.checkInSeconds)));if(D||!Y)return My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));b=[];m=W[0];if(!m.downloadState){B=void 0;My.q3(15);break}return g.S(My,GB(p.B,m.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:B=My.L;case 15:return P=B,aY=((fW=P)==null?0:fW.addedTimestampMillis)?String(P.addedTimestampMillis):void 0,g.Yl(My,17),g.S(My,hWU(p,q,aY,d),19);case 19:b=My.L;g.ac(My,18);break;case 17:M8=g.Ic(My);if(!(M8 instanceof Error&&
M8.message==="No data for playlist")){if(M8 instanceof Error&&M8.message==="Empty response body for playlist")HY(M8.message);else return nW="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",i8="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M8 instanceof g.jz&&M8.type==="QUOTA_EXCEEDED"&&(nW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",i8="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,nW,i8));My.q3(18);
break}return g.S(My,ebJ(q,p.B,l,p.X),18);case 18:if(!a)return My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));W$=[];et=new Map;if((I=b)==null?0:I.length)for(n=g.Z(b),w=n.next();!w.done;w=n.next())k=w.value,y=k.offlineVideoData,pW=void 0,((pW=y)==null?0:pW.videoId)&&et.set(y.videoId,y);Hi=new Map;qr=[];if((K=m)==null?0:(Rc=K.videos)==null?0:Rc.length)for(T$=g.Z(m.videos),tg=T$.next();!tg.done;tg=T$.next())if(Nr=tg.value,TU=JSON.parse(g.Cu(Nr).entityId),JS=TU.videoId)et.has(JS)?(Hi.set(JS,
et.get(JS)),et.delete(JS)):qr.push(JS);xl=Number(((jC=l.actionMetadata)==null?void 0:jC.priority)||0)+1;fq=g.Z(et.entries());for(Ew=fq.next();!Ew.done;Ew=fq.next())KV=Ew.value,PO=g.Z(KV),Fy=PO.next().value,P2=PO.next().value,gP=Fy,xu=P2,W$.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",gP,"mainVideoEntity",xl,O3,ap8(l,xu,q)));Yu=g.Z(Hi.entries());for(rQ=Yu.next();!rQ.done;rQ=Yu.next())Ne=rQ.value,jn=g.Z(Ne),Vp=jn.next().value,gB=jn.next().value,s9=Vp,I2=gB,W$.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
s9,"mainVideoEntity",xl,O3,ap8(l,I2,q)));iR=g.Z(qr);for(Uh=iR.next();!Uh.done;Uh=iR.next())Hh=Uh.value,VB={playlistId:q},Cw={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:VB},W$.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Hh,"mainVideoEntity",0,O3,Cw));return My.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,W$))}})},XFG=function(p,l){var Q,H,q,W;
return g.V(function(c){switch(c.B){case 1:return Q=Rw(l),g.Yl(c,2),H=g.Cu(l.entityKey).entityId,H==="!*$_ALL_ENTITIES_!*$"?g.S(c,ZDY(p.B,l,p.X,(q=l.actionMetadata)==null?void 0:(W=q.offlineLoggingData)==null?void 0:W.offlineDeleteReason),5):g.S(c,ebJ(H,p.B,l,p.X),6);case 6:if(!p.lO.D("woffle_enable_main_downloads_library")){c.q3(5);break}return g.S(c,nYY(p.B,l.entityKey),5);case 5:g.ac(c,3);break;case 2:return g.Ic(c),c.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},hWU=function(p,l,Q,H){var q,W,c,E,R,F,r;
return g.V(function(d){switch(d.B){case 1:return g.S(d,oYY([l]),2);case 2:return q=d.L,g.S(d,wF$(p,q[0],Q,H),3);case 3:return W=d.L,c=W.mainPlaylistEntity,E=W.AAi,F=M8b(c,(R=E)==null?void 0:R.avatar),g.Yl(d,4),g.S(d,hU(F),6);case 6:g.ac(d,5);break;case 4:r=g.Ic(d),r instanceof Error&&r.message==="Failed to fetch"&&HY(r.message);case 5:return d.return(q[0].videos)}})},wF$=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u;
return g.V(function(J){switch(J.B){case 1:q=Date.now().toString();Q||(Q=q);W=l.videos;c=l.playlistId;E=[];R=[];if(W)for(F=g.Z(W),r=F.next();!r.done;r=F.next()){d=r.value;M=d.offlineVideoData;if(!M||!M.videoId)throw HY("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");T=M.videoId;e={videoId:T,playlistId:c};Y={id:g.OY(JSON.stringify(e),"mainPlaylistVideoEntity"),video:g.OY(T,"mainVideoEntity")};E.push(Y);R.push(Y.id)}D={key:g.OY(c,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Q,lastSyncedTimestampMillis:q};X={key:g.OY(c,"mainPlaylistEntity"),playlistId:c,videos:R,title:l.title,thumbnailStyleData:S2U(l),visibility:NMt(l),downloadState:D.key};l.channel&&(N=l.channel.offlineChannelData,a=Vkb(g.OY(c,"ytMainChannelEntity"),N),X.channelOwner=a.id);((u=X)==null?0:u.entityMetadata)?(X.entityMetadata.offlineLastModifiedTimestampSeconds=l.lastModifiedTimestamp,H&&(X.entityMetadata.nextAutoRefreshIntervalSeconds=String(H))):X&&(X.entityMetadata={nextAutoRefreshIntervalSeconds:H?
String(H):void 0,offlineLastModifiedTimestampSeconds:l.lastModifiedTimestamp});g.Yl(J,2);return g.S(J,vR(p.B,{mode:"readwrite",Es:!0},function(iP){var C=x8(iP,X,"mainPlaylistEntity"),$l=x8(iP,D,"mainPlaylistDownloadStateEntity");C=[C,$l];$l=g.Z(E);for(var Wi=$l.next();!Wi.done;Wi=$l.next())C.push(x8(iP,Wi.value,"mainPlaylistVideoEntity"));a&&C.push(x8(iP,a,"ytMainChannelEntity"));return g.Yd.all(C)}),4);
case 4:g.ac(J,3);break;case 2:throw g.Ic(J),HY("PES failure for playlist"),Error("PES failure for playlist");case 3:return J.return({mainPlaylistEntity:X,AAi:a,ION:E})}})},Vkb=function(p,l){return{id:p,
channelId:l.channelId,title:l.title,avatar:l.thumbnail}},S2U=function(p){var l=[],Q=p.videos;
Q&&Q.length>0&&l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Q[0].offlineVideoData.thumbnail}}});if((p=p.additionalMetadadatas)&&p.length>0)for(p=g.Z(p),Q=p.next();!Q.done;Q=p.next()){var H=Q.value.offlineBundleItemPlaylistData,q=void 0;Q=(q=H)==null?void 0:q.style;q=void 0;H={collageThumbnail:{coverThumbnail:(q=H)==null?void 0:q.coverThumbnail}};switch(Q){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:H});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:H});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:H});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:H})}}return l},NMt=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ap8=function(p,l,Q){l={offlineVideoData:l,
playlistId:Q};if(p=g.f(p.actionMetadata,DA5))l.maximumDownloadQuality=p.maximumDownloadQuality;return{mainVideoEntityActionMetadata:l}},ku8=function(p,l,Q){this.B=p;
this.lO=l;this.X=Q},ym8=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e;
return g.V(function(Y){switch(Y.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,W=g.f(l.actionMetadata,vY),E=!((c=W)==null?0:c.playlistId),g.Yl(Y,2),g.S(Y,unt(p,q,void 0,(R=W)==null?void 0:R.offlineVideoData,E),4);case 4:g.ac(Y,3);break;case 2:return F=g.Ic(Y),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.jz&&F.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,r,d));case 3:M=1;M=Number(((T=l.actionMetadata)==null?void 0:T.priority)||0)+1;var a=(a=g.f(l.actionMetadata,vY))?{playbackDataActionMetadata:{maximumDownloadQuality:a.maximumDownloadQuality}}:void 0;e=ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"playbackData",M,K0J,a);return Y.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,[e]))}})},L0S=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X;
return g.V(function(N){switch(N.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,g.S(N,GB(p.B,l.entityKey,"mainVideoEntity"),2);case 2:W=N.L;if(!W){c=void 0;N.q3(3);break}return g.S(N,GB(p.B,W.downloadState,"mainVideoDownloadStateEntity"),4);case 4:c=N.L;case 3:E=c;if(!W||!E)return N.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.Yl(N,5);return g.S(N,unt(p,q,E.addedTimestampMillis,(F=g.f(l.actionMetadata,vY))==null?void 0:F.offlineVideoData),7);case 7:r=1;r=Number(((d=
l.actionMetadata)==null?void 0:d.priority)||0)+1;R=ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"playbackData",r,K0J);g.ac(N,6);break;case 5:M=g.Ic(N);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")HY(M.message);else return T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.jz&&M.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),N.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,T,e));N.q3(6);break}return g.S(N,Db(p.B,q),9);case 9:Y=N.L;a=g.f(l.actionMetadata,vY);if(X=(D=a)==null?void 0:D.playlistId)Y.playlistId=X;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.S(N,aw(q,p.B,l,p.X,Y),6);case 6:return N.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,R?[R]:void 0))}})},ovG=function(p,l){var Q,H,q,W,c,E,R,F,r,d;
return g.V(function(M){switch(M.B){case 1:return Q=Rw(l),g.Yl(M,2),H=g.Cu(l.entityKey).entityId,H==="!*$_ALL_ENTITIES_!*$"?g.S(M,ZDY(p.B,l,p.X,(r=l.actionMetadata)==null?void 0:(d=r.offlineLoggingData)==null?void 0:d.offlineDeleteReason),5):g.S(M,Db(p.B,H),6);case 6:q=M.L;W=g.f(l.actionMetadata,vY);if(E=(c=W)==null?void 0:c.playlistId)q.playlistId=E;q.offlineDeleteReason=(R=l.actionMetadata)==null?void 0:(F=R.offlineLoggingData)==null?void 0:F.offlineDeleteReason;return g.S(M,aw(H,p.B,l,p.X,q),7);
case 7:if(!p.lO.D("woffle_enable_main_downloads_library")){M.q3(5);break}return g.S(M,nYY(p.B,l.entityKey),5);case 5:g.ac(M,3);break;case 2:return g.Ic(M),M.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},unt=function(p,l,Q,H,q){var W,c,E,R,F,r;
return g.V(function(d){switch(d.B){case 1:if(W=H){d.q3(2);break}return g.S(d,Ltb([l]),3);case 3:c=d.L,W=c[0];case 2:return g.S(d,AmG(p,W,Q,q),4);case 4:E=d.L;R=E.mainVideoEntity;F=E.channelEntity;g.Yl(d,5);var M=e4(R.thumbnail),T=e4(F.avatar);return g.S(d,hU(M.concat(T)),7);case 7:g.ac(d,0);break;case 5:r=g.Ic(d),r instanceof Error&&r.message==="Failed to fetch"&&HY(r.message),g.Bi(d)}})},AmG=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M,T,e,Y,a;
return g.V(function(D){switch(D.B){case 1:Q||(Q=Date.now().toString());W=(q=l.channel)==null?void 0:q.offlineChannelData;c={id:g.OY(l.videoId,"ytMainChannelEntity"),channelId:W.channelId,title:W.title,avatar:W.thumbnail};E={key:g.OY(l.videoId,"mainVideoDownloadStateEntity"),playbackData:g.OY(l.videoId,"playbackData"),addedTimestampMillis:Q,videoDownloadContextEntity:g.OY(l.videoId,"videoDownloadContextEntity")};R={key:g.OY(l.videoId,"videoPlaybackPositionEntity"),videoId:l.videoId,lastPlaybackPositionSeconds:"0"};
p.lO.D("html5_offline_playback_position_sync")&&(F={playbackPosition:R.key});r=g.OY(l.videoId,"mainVideoEntity");d={key:r,videoId:l.videoId,title:l.title,thumbnail:l.thumbnail,localizedStrings:{viewCount:l.shortViewCountText},userState:F,lengthSeconds:l.lengthSeconds?Number(l.lengthSeconds):void 0,publishedTimestampMillis:l.publishedTimestamp?(Number(l.publishedTimestamp)*1E3).toString():void 0,formattedDescription:l.description,owner:c.id,downloadState:E.key};if(!p.lO.D("woffle_enable_main_downloads_library")||
!H){D.q3(2);break}return g.S(D,IaC(p.B,[r]),3);case 3:if(e=D.L)M=e.mainDownloadsLibraryEntity,T=e.mainDownloadsListEntity;case 2:return a=EY5,Y={key:g.OY(l.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Jc(E,a,Y),g.S(D,vR(p.B,{mode:"readwrite",Es:!0},function(X){var N=x8(X,c,"ytMainChannelEntity"),u=x8(X,E,"mainVideoDownloadStateEntity"),J=x8(X,d,"mainVideoEntity");N=[N,u,J];p.lO.D("html5_offline_playback_position_sync")&&(u=x8(X,R,"videoPlaybackPositionEntity"),
N.push(u));M&&(u=x8(X,M,"mainDownloadsLibraryEntity"),N.push(u));T&&(u=x8(X,T,"mainDownloadsListEntity"),N.push(u));Y&&(X=x8(X,Y,"downloadStatusEntity"),N.push(X));return g.Yd.all(N)}),4);
case 4:return D.return({mainVideoEntity:d,channelEntity:c})}})},Jm8=function(p,l,Q){this.B=p;
this.lO=l;this.X=Q},gvb=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m;
return g.V(function(B){switch(B.B){case 1:return Q=Rw(l),H=[],g.S(B,Jx.getInstance(),2);case 2:q=B.L;if(!q){B.q3(3);break}return g.S(B,q.get("sdois"),4);case 4:return W=B.L,g.S(B,(E=q)==null?void 0:E.get("lmqf"),5);case 5:c=B.L;case 3:g.Yl(B,6);if(W===void 0)throw Error("prefStorage or opt-in state is undefined");R=[];if(W){B.q3(8);break}return g.S(B,aa8(p.B),9);case 9:R=B.L,R.reverse();case 8:if(!R.length){B.q3(10);break}F=g.Z(R);r=F.next();case 11:if(r.done){B.q3(10);break}d=r.value;if(!d){B.q3(12);
break}M=g.Cu(d).entityId;return g.S(B,Db(p.B,M),14);case 14:return T=B.L,T.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.S(B,aw(M,p.B,{entityKey:d,actionType:l.actionType},p.X,T),12);case 12:r=F.next();B.q3(11);break;case 10:return g.S(B,gY$(W,(e=c)!=null?e:"SD"),16);case 16:return Y=B.L,g.S(B,BEU(Y),17);case 17:a=hbo(Y);if(!p.lO.D("woffle_enable_main_downloads_library")){B.q3(18);break}if(W){B.q3(19);break}return g.S(B,nYY(p.B,g.VZ),19);case 19:return g.S(B,DE8(p.B,[g.VZ]),18);
case 18:if((D=a)==null?0:D.length)for(X=g.Z(a),N=X.next();!N.done;N=X.next())if(J=u=N.value,iP=J.actionType,C=J.entityKey,$l=J.actionMetadata,iP&&C&&$l&&!g.f($l,fpS)){iP==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&($l.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Wi=g.f(u.actionMetadata,vY))Wi.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",u.actionMetadata=Object.assign({},u.actionMetadata,{mainVideoEntityActionMetadata:Wi});H.push(u)}g.ac(B,7);break;
case 6:return G=g.Ic(B),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.jz&&G.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,b,m));case 7:return B.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,H))}})},sRt=function(){U3.apply(this,arguments);
this.Y="mainVideoEntity"},bSo=function(p,l,Q){l=l===void 0?43200:l;
Q=Q===void 0?!0:Q;var H=H===void 0?!1:H;var q,W,c;return g.V(function(E){switch(E.B){case 1:if(!p.C.qp())return E.return([]);q=[];g.Yl(E,2);return g.S(E,JYU(l,Q,H),4);case 4:q=E.L;g.ac(E,3);break;case 2:W=g.Ic(E),W instanceof Error&&W.message==="No data"||W instanceof Error&&W.message==="Empty response body"&&HY(W.message);case 3:return c=ZSU(p,q,Q,"mainPlaylistEntity"),E.return(c)}})},PEG=function(p,l,Q,H){H=H===void 0?!1:H;
var q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X;return g.V(function(N){switch(N.B){case 1:return q=[],g.S(N,faS(),2);case 2:return(W=N.L)||H?g.S(N,suY(l,Q),3):N.return([]);case 3:c=N.L;if((E=c)==null||!E.length)return N.return([]);R={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};F=g.Z(c);r=F.next();case 4:if(r.done){N.q3(6);break}M=d=r.value;T=M.actionType;e=M.entityKey;Y=M.actionMetadata;if(!(T&&e&&Y)||g.f(Y,fpS)){N.q3(5);break}T==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.offlineLoggingData=
R);a=g.Cu(e);D=a.entityId;return g.S(N,Cc(p,[D],"mainVideoEntity",T,Y),8);case 8:X=N.L,q=q.concat(X);case 5:r=F.next();N.q3(4);break;case 6:return N.return(q)}})},xAS=function(p,l){this.B=p;
this.X=l},CEY=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D;
return g.V(function(X){switch(X.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,W=[],g.Yl(X,2),g.S(X,UAK(p,q),4);case 4:W=X.L;if((c=W)==null||!c.length){X.q3(5);break}return g.S(X,V8o(p.B,l.entityKey),5);case 5:g.ac(X,3);break;case 2:return E=g.Ic(X),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.jz&&E.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
X.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,R,F));case 3:return r=[],g.S(X,Rb8(p.B,"musicTrack",W),7);case 7:W=X.L;if(W.length)for(d=g.Z(W),M=d.next();!M.done;M=d.next())if(T=M.value,e=T.offlineVideoData,Y=void 0,(Y=e)==null?0:Y.videoId)a=void 0,D=Number(((a=l.actionMetadata)==null?void 0:a.priority)||0)+1,r.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"musicTrack",D,mf,S4(l,e,q)));return X.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,r))}})},
OSb=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et,I,n,w,k,y,pW,Hi,qr,K,Rc,T$,tg,Nr,TU,JS,jC,xl,fq,Ew,KV,PO,Fy,P2;
return g.V(function(gP){switch(gP.B){case 1:return Q=Rw(l),H=l.entityKey,q=g.Cu(H).entityId,W=[],c=!1,q==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.S(gP,it(p.B,"musicAlbumRelease"),5)):g.S(gP,GB(p.B,H,"musicAlbumRelease"),4);case 4:(E=gP.L)&&W.push(E);gP.q3(3);break;case 5:W=gP.L;case 3:if((R=W)==null||!R.length)return gP.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));if(c){F=[];r=g.Z(W);for(d=r.next();!d.done;d=r.next())M=d.value,T=g.Cu(M.id).entityId,F.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
T,"musicAlbumRelease",0,mf));return gP.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,F))}e=[];Y=W[0];a=void 0;if(!Y.downloadMetadata){gP.q3(6);break}return g.S(gP,GB(p.B,Y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:D=gP.L,a=Number((N=(X=D)==null?void 0:X.addedTimestampMillis)!=null?N:"0")/1E3;case 6:return g.Yl(gP,8),g.S(gP,UAK(p,q,(u=a)==null?void 0:u.toString()),10);case 10:e=gP.L;g.ac(gP,9);break;case 8:J=g.Ic(gP);if(!(J instanceof Error&&J.message===
"No data")){if(J instanceof Error&&J.message==="Empty response body")HY(J.message);else return iP="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.jz&&J.type==="QUOTA_EXCEEDED"&&(iP="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gP.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,iP,C));gP.q3(9);break}return g.S(gP,XG(q,"musicAlbumRelease",
p.B,l,p.X),9);case 9:$l=[];Wi=new Map;if((G=e)==null?0:G.length)for(b=g.Z(e),m=b.next();!m.done;m=b.next())B=m.value,P=B.offlineVideoData,fW=void 0,((fW=P)==null?0:fW.videoId)&&Wi.set(P.videoId,P);aY=new Map;M8=[];if((nW=Y)==null?0:(i8=nW.tracks)==null?0:i8.length)for(W$=g.Z(Y.tracks),et=W$.next();!et.done;et=W$.next())if(I=et.value,n=g.Cu(I).entityId)Wi.has(n)?(aY.set(n,Wi.get(n)),Wi.delete(n)):M8.push(n);k=Number(((w=l.actionMetadata)==null?void 0:w.priority)||0)+1;y=g.Z(Wi.entries());for(pW=y.next();!pW.done;pW=
y.next())Hi=pW.value,qr=g.Z(Hi),K=qr.next().value,Rc=qr.next().value,T$=K,tg=Rc,$l.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T$,"musicTrack",k,mf,S4(l,tg)));Nr=g.Z(aY.entries());for(TU=Nr.next();!TU.done;TU=Nr.next())JS=TU.value,jC=g.Z(JS),xl=jC.next().value,fq=jC.next().value,Ew=xl,KV=fq,$l.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Ew,"musicTrack",k,mf,S4(l,KV)));PO=g.Z(M8);for(Fy=PO.next();!Fy.done;Fy=PO.next())P2=Fy.value,$l.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",P2,
"musicTrack",0,mf));return gP.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,$l))}})},vvS=function(p,l){var Q,H;
return g.V(function(q){switch(q.B){case 1:return Q=Rw(l),g.Yl(q,2),H=g.Cu(l.entityKey).entityId,H==="!*$_ALL_ENTITIES_!*$"?g.S(q,wm(p.B,l,p.X),5):g.S(q,XG(H,"musicAlbumRelease",p.B,l,p.X),6);case 6:return g.S(q,kJ8(p.B,l.entityKey),5);case 5:g.ac(q,3);break;case 2:return g.Ic(q),q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},UAK=function(p,l,Q){var H,q,W;
return g.V(function(c){switch(c.B){case 1:return g.S(c,oYY([l]),2);case 2:return H=c.L,g.S(c,mAo(p,H[0],Q),3);case 3:return q=c.L,W=e4(q.thumbnailDetails),g.S(c,hU(W),4);case 4:return c.return(H[0].videos)}})},mAo=function(p,l,Q){var H,q,W,c,E,R,F,r,d,M,T,e,Y,a;
return g.V(function(D){if(D.B==1){H=l.additionalMetadadatas;q=void 0;if(H&&H.length>0)for(W=g.Z(H),c=W.next();!c.done;c=W.next())if(E=c.value,E.offlineMusicPlaylistData){q=E.offlineMusicPlaylistData;break}R=l.playlistId;F=uuU(l);r=F.tF;d=F.Lu;M=Q?(Number(Q)*1E3).toString():Date.now().toString();T=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0";e={id:g.OY(R,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:d,lastModifiedTimestampMillis:T,addedTimestampMillis:M,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Y={id:g.OY(R,"musicAlbumRelease"),title:l.title,audioPlaylistId:R,trackCount:l.totalVideoCount,tracks:r,downloadMetadata:e.id};q&&(Y.thumbnailDetails=(a=q.albumHqThumbnail)!=null?a:q.albumArtistThumbnail,Y.artistDisplayName=q.albumArtistDisplayName,Y.releaseDate=q.albumReleaseDate,Y.contentRating={explicitType:q.albumReleaseExplicitType},Y.releaseType=q.albumReleaseType);return g.S(D,vR(p.B,{mode:"readwrite",Es:!0},function(X){var N=x8(X,Y,"musicAlbumRelease");
X=x8(X,e,"musicAlbumReleaseDownloadMetadataEntity");return g.Yd.all([N,X])}),2)}return D.return(Y)})},Gu$=function(p,l){this.B=p;
this.X=l},pHJ=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D;
return g.V(function(X){switch(X.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,W=[],g.Yl(X,2),g.S(X,iwo(p,q),4);case 4:W=X.L;if((c=W)==null||!c.length){X.q3(5);break}return g.S(X,V8o(p.B,l.entityKey),5);case 5:g.ac(X,3);break;case 2:return E=g.Ic(X),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.jz&&E.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
X.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,R,F));case 3:return r=[],g.S(X,Rb8(p.B,"musicTrack",W),7);case 7:W=X.L;if(W.length)for(d=g.Z(W),M=d.next();!M.done;M=d.next())if(T=M.value,e=T.offlineVideoData,Y=void 0,(Y=e)==null?0:Y.videoId)a=void 0,D=Number(((a=l.actionMetadata)==null?void 0:a.priority)||0)+1,r.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"musicTrack",D,GV,S4(l,e,q)));return X.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,r))}})},
lgU=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et,I,n,w,k,y,pW,Hi,qr,K,Rc,T$,tg,Nr,TU,JS,jC,xl,fq,Ew,KV,PO,Fy,P2,gP,xu,Yu,rQ,Ne,jn,Vp,gB,s9,I2,iR,Uh;
return g.V(function(Hh){switch(Hh.B){case 1:return Q=Rw(l),H=l.entityKey,q=g.Cu(H).entityId,W=[],c=!1,q==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.S(Hh,it(p.B,"musicPlaylist"),5)):g.S(Hh,GB(p.B,H,"musicPlaylist"),4);case 4:(E=Hh.L)&&W.push(E);Hh.q3(3);break;case 5:W=Hh.L;case 3:if((R=W)==null||!R.length)return Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));F=g.f(l.actionMetadata,Kt8);d=(r=F)==null?void 0:r.autoSync;M=[];e=T=!0;Y=!1;a=void 0;if(!c&&d===!1){Hh.q3(6);break}g.Yl(Hh,7);return g.S(Hh,
bDY(0,!!d,!0,W),9);case 9:M=Hh.L;g.ac(Hh,8);break;case 7:D=g.Ic(Hh);if(!(D instanceof Error&&D.message==="No data")){D instanceof Error&&D.message==="Empty response body"&&HY(D.message);Hh.q3(8);break}return q==="!*$_ALL_ENTITIES_!*$"?g.S(Hh,wm(p.B,l,p.X),8):g.S(Hh,XG(q,"musicPlaylist",p.B,l,p.X),8);case 8:if(!M.length||!c&&M[0].playlistId!==q)return Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));case 6:if(c){X=[];N=g.Z(M);for(u=N.next();!u.done;u=N.next())J=u.value,J.upToDate||
d&&!J.shouldAutoSyncMetadata||!J.playlistId||(iP={autoSync:d},X.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J.playlistId,"musicPlaylist",0,GV,{musicPlaylistEntityActionMetadata:iP})));return Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,X))}M.length&&(C=M[0],Y=!!C.upToDate,d&&(T=($l=C.shouldAutoSyncMetadata)!=null?$l:!0,e=(Wi=C.shouldAutoSyncVideos)!=null?Wi:!0,C.checkInSeconds&&(a=C.checkInSeconds)));if(Y||!T)return Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));G=[];b=W[0];m=void 0;if(!b.downloadMetadata){Hh.q3(15);break}return g.S(Hh,GB(p.B,b.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:B=Hh.L,m=Number((fW=(P=B)==null?void 0:P.addedTimestampMillis)!=null?fW:"0")/1E3;case 15:return g.Yl(Hh,17),g.S(Hh,iwo(p,q,(aY=m)==null?void 0:aY.toString(),a),19);case 19:G=Hh.L;g.ac(Hh,18);break;case 17:M8=g.Ic(Hh);if(!(M8 instanceof Error&&M8.message==="No data")){if(M8 instanceof Error&&M8.message==="Empty response body")HY(M8.message);else return nW=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",i8="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M8 instanceof g.jz&&M8.type==="QUOTA_EXCEEDED"&&(nW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",i8="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,nW,i8));Hh.q3(18);break}return g.S(Hh,XG(q,"musicPlaylist",p.B,l,p.X),18);case 18:if(!e)return Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));W$=[];et=new Map;if((I=G)==null?0:I.length)for(n=g.Z(G),w=n.next();!w.done;w=n.next())k=w.value,y=k.offlineVideoData,pW=void 0,((pW=y)==null?0:pW.videoId)&&et.set(y.videoId,y);Hi=new Map;qr=[];if((K=b)==null?0:(Rc=K.tracks)==null?0:Rc.length)for(T$=g.Z(b.tracks),tg=T$.next();!tg.done;tg=T$.next())if(Nr=tg.value,TU=g.Cu(Nr).entityId)et.has(TU)?(Hi.set(TU,et.get(TU)),et.delete(TU)):qr.push(TU);jC=Number(((JS=l.actionMetadata)==null?void 0:JS.priority)||0)+1;xl=g.Z(et.entries());for(fq=xl.next();!fq.done;fq=
xl.next())Ew=fq.value,KV=g.Z(Ew),PO=KV.next().value,Fy=KV.next().value,P2=PO,gP=Fy,W$.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P2,"musicTrack",jC,GV,S4(l,gP)));xu=g.Z(Hi.entries());for(Yu=xu.next();!Yu.done;Yu=xu.next())rQ=Yu.value,Ne=g.Z(rQ),jn=Ne.next().value,Vp=Ne.next().value,gB=jn,s9=Vp,W$.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",gB,"musicTrack",jC,GV,S4(l,s9)));I2=g.Z(qr);for(iR=I2.next();!iR.done;iR=I2.next())Uh=iR.value,W$.push(ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Uh,"musicTrack",0,GV));return Hh.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,W$))}})},Q88=function(p,l){var Q,H;
return g.V(function(q){switch(q.B){case 1:return Q=Rw(l),g.Yl(q,2),H=g.Cu(l.entityKey).entityId,H==="!*$_ALL_ENTITIES_!*$"?g.S(q,wm(p.B,l,p.X),5):g.S(q,XG(H,"musicPlaylist",p.B,l,p.X),6);case 6:return g.S(q,kJ8(p.B,l.entityKey),5);case 5:g.ac(q,3);break;case 2:return g.Ic(q),q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},iwo=function(p,l,Q,H){var q,W,c;
return g.V(function(E){switch(E.B){case 1:return g.S(E,oYY([l]),2);case 2:return q=E.L,g.S(E,$kU(p,q[0],Q,H),3);case 3:return W=E.L,c=e4(W.thumbnailDetails),g.S(E,hU(c),4);case 4:return E.return(q[0].videos)}})},$kU=function(p,l,Q,H){var q,W,c,E,R,F,r,d,M;
return g.V(function(T){return T.B==1?(q=l.playlistId,W=uuU(l),c=W.tF,E=W.Lu,R=Q?(Number(Q)*1E3).toString():Date.now().toString(),F=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0",r={id:g.OY(q,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:F,addedTimestampMillis:R,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},d={id:g.OY(q,"musicPlaylist"),title:l.title,playlistId:q,thumbnailDetails:l.thumbnail,visibility:HwU(l),trackCount:l.totalVideoCount,
tracks:c,downloadMetadata:r.id},H&&(((M=d)==null?0:M.entityMetadata)?d.entityMetadata.nextAutoRefreshIntervalSeconds=String(H):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:String(H)})),g.S(T,vR(p.B,{mode:"readwrite",Es:!0},function(e){var Y=x8(e,d,"musicPlaylist");e=x8(e,r,"musicPlaylistDownloadMetadataEntity");return g.Yd.all([Y,e])}),2)):T.return(d)})},HwU=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},qpY=function(p,l){this.B=p;
this.X=l},EN8=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e;
return g.V(function(Y){switch(Y.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,W=g.f(l.actionMetadata,Wmo),g.Yl(Y,2),g.S(Y,cVJ(p,q,void 0,(c=W)==null?void 0:c.track,(E=W)==null?void 0:E.albumRelease),4);case 4:if((R=W)==null?0:R.playlistId){Y.q3(5);break}return g.S(Y,V8o(p.B,l.entityKey),5);case 5:g.ac(Y,3);break;case 2:return F=g.Ic(Y),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.jz&&F.type==="QUOTA_EXCEEDED"&&
(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,r,d));case 3:T=Number(((M=l.actionMetadata)==null?void 0:M.priority)||0)+1;var a=(a=g.f(l.actionMetadata,Wmo))?{playbackDataActionMetadata:{maximumDownloadQuality:a.maximumDownloadQuality}}:void 0;e=ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"playbackData",T,tNo,a);return Y.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q,[e]))}})},R_Y=function(p,l){var Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a;
return g.V(function(D){switch(D.B){case 1:return Q=Rw(l),H=g.Cu(l.entityKey),q=H.entityId,g.S(D,GB(p.B,l.entityKey,"musicTrack"),2);case 2:W=D.L;if(!W){c=void 0;D.q3(3);break}return g.S(D,GB(p.B,W.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:c=D.L;case 3:E=c;if(!W||!E)return D.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));F=g.f(l.actionMetadata,Wmo);g.Yl(D,5);return g.S(D,cVJ(p,q,E.addedTimestampMillis,(r=F)==null?void 0:r.track,(d=F)==null?void 0:d.albumRelease),
7);case 7:T=Number(((M=l.actionMetadata)==null?void 0:M.priority)||0)+1;R=ut("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"playbackData",T,tNo);g.ac(D,6);break;case 5:e=g.Ic(D);if(!(e instanceof Error&&e.message==="No data")){if(e instanceof Error&&e.message==="Empty response body")HY(e.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.jz&&e.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),D.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,Y,a));D.q3(6);break}return g.S(D,nc(q,p.B,l,p.X),6);case 6:return D.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,R?[R]:void 0))}})},Fmo=function(p,l){var Q,H;
return g.V(function(q){switch(q.B){case 1:return Q=Rw(l),g.Yl(q,2),H=g.Cu(l.entityKey).entityId,H==="!*$_ALL_ENTITIES_!*$"?g.S(q,wm(p.B,l,p.X),5):g.S(q,nc(H,p.B,l,p.X),6);case 6:return g.S(q,kJ8(p.B,l.entityKey),5);case 5:g.ac(q,3);break;case 2:return g.Ic(q),q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new Kc("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},cVJ=function(p,l,Q,H,q){var W,c,E,R,F,r;
return g.V(function(d){switch(d.B){case 1:if(W=H){d.q3(2);break}return g.S(d,Ltb([l]),3);case 3:c=d.L,E=c[0],W=NEJ(E);case 2:return g.S(d,rVb(p,W,l,q,Q),4);case 4:R=d.L;F=R.musicTrackEntity;r=R.Tx;var M=e4(F.thumbnailDetails),T=[];r&&(T=e4(r.thumbnailDetails));return g.S(d,hU(M.concat(T)),0)}})},rVb=function(p,l,Q,H,q){var W;
return g.V(function(c){return c.B==1?(q||(q=Date.now().toString()),W={id:g.OY(Q,"musicTrackDownloadMetadataEntity"),playbackData:g.OY(Q,"playbackData"),addedTimestampMillis:q,videoDownloadContextEntity:g.OY(Q,"videoDownloadContextEntity")},H&&(l.albumRelease=H.id),g.S(c,vR(p.B,{mode:"readwrite",Es:!0},function(E){var R=[],F=x8(E,W,"musicTrackDownloadMetadataEntity");R.push(F);F=x8(E,l,"musicTrack");R.push(F);H&&(E=x8(E,H,"musicAlbumRelease"),R.push(E));return g.Yd.all(R)}),2)):c.B!=3?g.S(c,j4(Q,"musicTrackDownloadMetadataEntity",
p.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):c.return({musicTrackEntity:l,
Tx:H})})},iW=function(){U3.apply(this,arguments);
this.Y="musicTrack"},dkG=function(p,l,Q){l=l===void 0?43200:l;
Q=Q===void 0?!0:Q;var H=H===void 0?!1:H;var q,W;return g.V(function(c){switch(c.B){case 1:if(!p.C.qp())return c.return([]);q=[];g.Yl(c,2);return g.S(c,bDY(l,Q,H),4);case 4:q=c.L;g.ac(c,3);break;case 2:g.Ic(c);case 3:return W=ZSU(p,q,Q,"musicPlaylist"),c.return(W)}})},j8C=function(){g.eH.apply(this,arguments);
var p=this;this.events=new g.kg(this);this.lO=this.player.U();this.tR={WFi:function(){return p.B},
c8:function(){return p.c8()},
jY:function(l){return p.jY(l)}}},MN8=function(p){var l;
p=g.f((l=p.getWatchNextResponse())==null?void 0:l.currentVideoEndpoint,g.vC);if(p==null?0:p.playlistId)var Q=p.playlistId;return Q},TGK=function(p,l){var Q,H,q,W;
return g.V(function(c){if(c.B==1){Q=l.clientPlaybackNonce;H={cpn:Q,offlineSourceVisualElement:g.hc(l.KK||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};l.L&&(H.videoFmt=Number(l.L.itag));l.j&&(H.audioFmt=Number(l.j.itag));if((q=MN8(l))&&l.videoId){var E=l.videoId;E=q!=="PPSV"?Promise.resolve(!1):p.B.XL(E);c=g.S(c,E,3)}else c=c.q3(2);return c}c.B!=2&&(W=c.L)&&(H.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");p.L=Q;g.cA("offlinePlaybackStarted",H);g.Bi(c)})};
g.aM.prototype.Fk=g.ci(51,function(p){return this.app.Fk(p)});
g.M0.prototype.Fk=g.ci(50,function(p){return g.JUJ(this,9,p)});
g.z(oP,L0);g.EX.Object.defineProperties(oP.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(p){this.B.entityMetadata=p}}});
g.z(R08,oP);R08.prototype.L=function(){return[]};
g.z(F8t,oP);F8t.prototype.L=function(){return[]};
g.z(r6b,oP);r6b.prototype.L=function(){return[]};
g.z(dOo,oP);dOo.prototype.L=function(){return[]};
g.z(jG$,oP);jG$.prototype.L=function(){var p=[];this.B.alternateChannel&&p.push(this.B.alternateChannel);this.B.alternateChannelList&&p.push.apply(p,g.h(this.B.alternateChannelList));this.B.oneofChannelEntity&&p.push(this.B.oneofChannelEntity);return[].concat(g.h(new Set(p)))};
g.z(M_b,oP);M_b.prototype.L=function(){var p=[];this.B.entryCollection&&p.push(this.B.entryCollection);return[].concat(g.h(new Set(p)))};
g.z(TB8,L0);TB8.prototype.L=function(){var p=[];this.B.video&&p.push(this.B.video);return[].concat(g.h(new Set(p)))};
g.z(e0Y,oP);e0Y.prototype.L=function(){var p=[];this.B.parentPlaylist&&p.push(this.B.parentPlaylist);if(this.B.entries)for(var l=g.Z(this.B.entries),Q=l.next();!Q.done;Q=l.next())p.push.apply(p,g.h((new TB8(Q.value)).L()));return[].concat(g.h(new Set(p)))};
g.z(z08,oP);z08.prototype.L=function(){var p=[];this.B.descriptionEntity&&p.push(this.B.descriptionEntity);this.B.creators&&p.push.apply(p,g.h(this.B.creators));this.B.theBiggestFan&&p.push(this.B.theBiggestFan);return[].concat(g.h(new Set(p)))};
g.z(ZbK,oP);ZbK.prototype.L=function(){return[]};
g.z(BBG,oP);BBG.prototype.L=function(){return[]};
g.z(Y9o,oP);Y9o.prototype.L=function(){return[]};
g.z(h0$,oP);h0$.prototype.L=function(){return[]};
g.z(a8C,oP);a8C.prototype.L=function(){return[]};
g.z(I8o,oP);I8o.prototype.L=function(){return[]};
g.z(DO8,oP);DO8.prototype.L=function(){return[]};
g.z(n08,oP);n08.prototype.L=function(){return[]};
g.z(Xao,oP);Xao.prototype.L=function(){return[]};
g.z(wao,oP);wao.prototype.L=function(){var p=[];this.B.downloadsList&&p.push(this.B.downloadsList);this.B.smartDownloadsList&&p.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&p.push(this.B.recommendedDownloadsList);this.B.refresh&&p.push(this.B.refresh);return[].concat(g.h(new Set(p)))};
g.z(S9U,L0);S9U.prototype.L=function(){var p=[];this.B.video&&p.push(this.B.video);this.B.playlist&&p.push(this.B.playlist);this.B.videoItem&&p.push(this.B.videoItem);this.B.playlistItem&&p.push(this.B.playlistItem);return[].concat(g.h(new Set(p)))};
g.z(NBK,oP);NBK.prototype.L=function(){var p=[];this.B.refresh&&p.push(this.B.refresh);if(this.B.downloads)for(var l=g.Z(this.B.downloads),Q=l.next();!Q.done;Q=l.next())p.push.apply(p,g.h((new S9U(Q.value)).L()));return[].concat(g.h(new Set(p)))};
g.z(V_C,oP);V_C.prototype.L=function(){var p=[];this.B.localImageEntities&&p.push.apply(p,g.h(this.B.localImageEntities));return[].concat(g.h(new Set(p)))};
g.z(kIG,oP);kIG.prototype.L=function(){var p=[];this.B.playbackData&&p.push(this.B.playbackData);this.B.localImageEntities&&p.push.apply(p,g.h(this.B.localImageEntities));this.B.videoDownloadContextEntity&&p.push(this.B.videoDownloadContextEntity);return[].concat(g.h(new Set(p)))};
g.z(ucY,oP);ucY.prototype.L=function(){return[]};
g.z(K8b,oP);K8b.prototype.L=function(){var p=[];this.B.fakeChildren&&p.push.apply(p,g.h(this.B.fakeChildren));return[].concat(g.h(new Set(p)))};
g.z(y6$,oP);y6$.prototype.L=function(){var p=[];this.B.video&&p.push(this.B.video);this.B.playbackData&&p.push(this.B.playbackData);this.B.offlineVideoPolicy&&p.push(this.B.offlineVideoPolicy);return[].concat(g.h(new Set(p)))};
g.z(L8C,oP);L8C.prototype.L=function(){return[]};
g.z(o0S,oP);o0S.prototype.L=function(){var p=[];this.B.channelOwner&&p.push(this.B.channelOwner);this.B.videos&&p.push.apply(p,g.h(this.B.videos));this.B.collaboratorChannels&&p.push.apply(p,g.h(this.B.collaboratorChannels));this.B.downloadState&&p.push(this.B.downloadState);this.B.refresh&&p.push(this.B.refresh);return[].concat(g.h(new Set(p)))};
g.z(A6o,oP);A6o.prototype.L=function(){var p=[];this.B.video&&p.push(this.B.video);this.B.channelContributor&&p.push(this.B.channelContributor);return[].concat(g.h(new Set(p)))};
g.z(J6J,L0);J6J.prototype.L=function(){var p=[];this.B.localImageEntities&&p.push.apply(p,g.h(this.B.localImageEntities));this.B.videoDownloadContextEntity&&p.push(this.B.videoDownloadContextEntity);return[].concat(g.h(new Set(p)))};
g.z(f8Y,L0);f8Y.prototype.L=function(){var p=[];this.B.recommendedVideoMetadata&&p.push.apply(p,g.h((new J6J(this.B.recommendedVideoMetadata)).L()));return[].concat(g.h(new Set(p)))};
g.z(g0K,L0);g0K.prototype.L=function(){var p=[];this.B.playbackPosition&&p.push(this.B.playbackPosition);return[].concat(g.h(new Set(p)))};
g.z(sGS,oP);sGS.prototype.L=function(){var p=[];this.B.owner&&p.push(this.B.owner);this.B.downloadState&&p.push(this.B.downloadState);this.B.userState&&p.push.apply(p,g.h((new g0K(this.B.userState)).L()));this.B.additionalMetadata&&p.push.apply(p,g.h((new f8Y(this.B.additionalMetadata)).L()));return[].concat(g.h(new Set(p)))};
g.z(bb$,oP);bb$.prototype.L=function(){var p=[];this.B.userChannelDetails&&p.push(this.B.userChannelDetails);return[].concat(g.h(new Set(p)))};
g.z(Pho,oP);Pho.prototype.L=function(){var p=[];this.B.channelOwner&&p.push(this.B.channelOwner);this.B.playbackPosition&&p.push(this.B.playbackPosition);this.B.localImageEntities&&p.push.apply(p,g.h(this.B.localImageEntities));this.B.downloadStatus&&p.push(this.B.downloadStatus);return[].concat(g.h(new Set(p)))};
g.z(xOS,oP);xOS.prototype.L=function(){return[]};
g.z(UOS,oP);UOS.prototype.L=function(){return[]};
g.z(Ch5,oP);Ch5.prototype.L=function(){return[]};
g.z(Ob5,oP);Ob5.prototype.L=function(){return[]};
g.z(v05,oP);v05.prototype.L=function(){return[]};
g.z(mOG,oP);mOG.prototype.L=function(){return[]};
g.z(GIY,oP);GIY.prototype.L=function(){return[]};
g.z(i6K,oP);i6K.prototype.L=function(){return[]};
g.z(pLo,oP);pLo.prototype.L=function(){return[]};
g.z(lsG,oP);lsG.prototype.L=function(){return[]};
g.z(Q4J,oP);Q4J.prototype.L=function(){return[]};
g.z($xK,oP);$xK.prototype.L=function(){var p=[];this.B.trackDownloadMetadatas&&p.push.apply(p,g.h(this.B.trackDownloadMetadatas));return[].concat(g.h(new Set(p)))};
g.z(H6G,oP);
H6G.prototype.L=function(){var p=[];this.B.downloadedTracks&&p.push.apply(p,g.h(this.B.downloadedTracks));this.B.smartDownloadedTracks&&p.push.apply(p,g.h(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&p.push.apply(p,g.h(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&p.push.apply(p,g.h(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&p.push.apply(p,g.h(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&p.push.apply(p,g.h(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
p.push.apply(p,g.h(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&p.push.apply(p,g.h(this.B.metadataOnlyTracks));return[].concat(g.h(new Set(p)))};
g.z(qdY,oP);qdY.prototype.L=function(){var p=[];this.B.trackDownloadMetadatas&&p.push.apply(p,g.h(this.B.trackDownloadMetadatas));return[].concat(g.h(new Set(p)))};
g.z(W2b,oP);W2b.prototype.L=function(){var p=[];this.B.playbackData&&p.push(this.B.playbackData);this.B.localImageEntities&&p.push.apply(p,g.h(this.B.localImageEntities));this.B.videoDownloadContextEntity&&p.push(this.B.videoDownloadContextEntity);return[].concat(g.h(new Set(p)))};
g.z(crK,oP);crK.prototype.L=function(){var p=[];this.B.musicLibraryStatusEntity&&p.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&p.push.apply(p,g.h(this.B.primaryArtists));this.B.details&&p.push(this.B.details);this.B.userDetails&&p.push(this.B.userDetails);this.B.tracks&&p.push.apply(p,g.h(this.B.tracks));this.B.share&&p.push(this.B.share);this.B.downloadMetadata&&p.push(this.B.downloadMetadata);this.B.refresh&&p.push(this.B.refresh);return[].concat(g.h(new Set(p)))};
g.z(trY,oP);trY.prototype.L=function(){var p=[];this.B.albumRelease&&p.push(this.B.albumRelease);this.B.tracks&&p.push.apply(p,g.h(this.B.tracks));return[].concat(g.h(new Set(p)))};
g.z(EW$,oP);EW$.prototype.L=function(){var p=[];this.B.albumRelease&&p.push(this.B.albumRelease);return[].concat(g.h(new Set(p)))};
g.z(RAo,oP);RAo.prototype.L=function(){var p=[];this.B.details&&p.push(this.B.details);this.B.userDetails&&p.push(this.B.userDetails);return[].concat(g.h(new Set(p)))};
g.z(F2$,oP);F2$.prototype.L=function(){var p=[];this.B.parentArtist&&p.push(this.B.parentArtist);return[].concat(g.h(new Set(p)))};
g.z(rr$,oP);rr$.prototype.L=function(){var p=[];this.B.parentArtist&&p.push(this.B.parentArtist);return[].concat(g.h(new Set(p)))};
g.z(dx8,oP);dx8.prototype.L=function(){return[]};
g.z(j4$,oP);j4$.prototype.L=function(){return[]};
g.z(Mr8,L0);Mr8.prototype.L=function(){var p=[];this.B.creatorEntity&&p.push(this.B.creatorEntity);return[].concat(g.h(new Set(p)))};
g.z(Tkb,oP);
Tkb.prototype.L=function(){var p=[];this.B.tracks&&p.push.apply(p,g.h(this.B.tracks));this.B.refresh&&p.push(this.B.refresh);this.B.musicLibraryStatusEntity&&p.push(this.B.musicLibraryStatusEntity);this.B.details&&p.push(this.B.details);this.B.downloadMetadata&&p.push(this.B.downloadMetadata);this.B.sideloadMetadata&&p.push(this.B.sideloadMetadata);this.B.userDetails&&p.push(this.B.userDetails);this.B.entryCollection&&p.push(this.B.entryCollection);this.B.share&&p.push(this.B.share);this.B.podcastShowAdditionalMetadata&&p.push.apply(p,
g.h((new Mr8(this.B.podcastShowAdditionalMetadata)).L()));return[].concat(g.h(new Set(p)))};
g.z(eA$,oP);eA$.prototype.L=function(){return[]};
g.z(zAC,oP);
zAC.prototype.L=function(){var p=[];this.B.musicLibraryStatusEntity&&p.push(this.B.musicLibraryStatusEntity);this.B.artists&&p.push.apply(p,g.h(this.B.artists));this.B.audioModeVersion&&p.push(this.B.audioModeVersion);this.B.videoModeVersion&&p.push(this.B.videoModeVersion);this.B.userDetails&&p.push(this.B.userDetails);this.B.details&&p.push(this.B.details);this.B.albumRelease&&p.push(this.B.albumRelease);this.B.share&&p.push(this.B.share);this.B.libraryEdit&&p.push(this.B.libraryEdit);this.B.downloadMetadata&&
p.push(this.B.downloadMetadata);this.B.playbackPosition&&p.push(this.B.playbackPosition);this.B.lyrics&&p.push(this.B.lyrics);return[].concat(g.h(new Set(p)))};
g.z(Z6o,oP);Z6o.prototype.L=function(){var p=[];this.B.parentTrack&&p.push(this.B.parentTrack);return[].concat(g.h(new Set(p)))};
g.z(Bkb,oP);Bkb.prototype.L=function(){var p=[];this.B.parentTrack&&p.push(this.B.parentTrack);return[].concat(g.h(new Set(p)))};
g.z(Ydb,oP);Ydb.prototype.L=function(){return[]};
g.z(hA8,oP);hA8.prototype.L=function(){return[]};
g.z(as$,oP);as$.prototype.L=function(){return[]};
g.z(IsJ,oP);IsJ.prototype.L=function(){return[]};
g.z(Dxo,oP);Dxo.prototype.L=function(){var p=[];this.B.transfer&&p.push(this.B.transfer);this.B.adsPlaybackData&&p.push.apply(p,g.h(this.B.adsPlaybackData));this.B.drmLicense&&p.push(this.B.drmLicense);this.B.offlineVideoPolicy&&p.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&p.push(this.B.videoDownloadContextEntity);return[].concat(g.h(new Set(p)))};
g.z(nWC,oP);nWC.prototype.L=function(){return[]};
g.z(XLo,oP);XLo.prototype.L=function(){var p=[];this.B.offlineVideoStreams&&p.push.apply(p,g.h(this.B.offlineVideoStreams));this.B.captionTrack&&p.push.apply(p,g.h(this.B.captionTrack));return[].concat(g.h(new Set(p)))};
g.z(wLt,oP);wLt.prototype.L=function(){return[]};
g.z(SdJ,oP);SdJ.prototype.L=function(){return[]};
g.z(Nko,oP);Nko.prototype.L=function(){return[]};
g.z(Vro,oP);Vro.prototype.L=function(){return[]};
g.z(kX$,oP);kX$.prototype.L=function(){return[]};
g.z(uat,oP);uat.prototype.L=function(){return[]};
g.z(K2t,oP);K2t.prototype.L=function(){return[]};
g.z(yrK,oP);yrK.prototype.L=function(){return[]};
g.z(L2Y,oP);L2Y.prototype.L=function(){return[]};
g.z(oWC,oP);oWC.prototype.L=function(){return[]};
g.z(ArU,oP);ArU.prototype.L=function(){return[]};
g.z(Jrb,oP);Jrb.prototype.L=function(){return[]};
g.z(fsb,oP);fsb.prototype.L=function(){return[]};
g.z(gWG,oP);gWG.prototype.L=function(){return[]};
g.z(s4G,oP);s4G.prototype.L=function(){return[]};
g.z(b6$,oP);b6$.prototype.L=function(){return[]};
g.z(Pn5,oP);Pn5.prototype.L=function(){return[]};
g.z(xxo,oP);xxo.prototype.L=function(){return[]};
g.z(Uxo,oP);Uxo.prototype.L=function(){return[]};
g.z(Cn8,oP);Cn8.prototype.L=function(){return[]};
var PYt=["browse","music/browse","unplugged/browse"],vYo=["offline/playlist_sync_check"],yY5=["offline"],xEb=["offline/offline_video_playback_position_sync"],CYS=["offline/get_playback_data_entity"],Ax;Jx.getInstance=function(){return g.V(function(p){return p.return(new Promise(function(l){g.vA().then(function(Q){Q?(Jx.instance||(Jx.instance=new Jx(Q)),l(Jx.instance)):l(void 0)})}))})};
Jx.prototype.get=function(p){var l=this,Q,H,q;return g.V(function(W){if(W.B==1)return g.S(W,GXt(l.token),2);if(W.B!=3)return Q=W.L,g.S(W,Q.get("prefs",p),3);H=W.L;if(!H)return W.return();q=(0,g.DX)();return H.expirationTimestampMs<=q?W.return():W.return(H.value)})};
Jx.prototype.set=function(p,l,Q){Q=Q===void 0?31536E3:Q;var H=this,q,W,c;return g.V(function(E){if(E.B==1)return q=(0,g.DX)(),W={key:p,value:l,expirationTimestampMs:q+Q*1E3},g.S(E,GXt(H.token),2);c=E.L;return g.S(E,g.VL(c,"prefs",W),0)})};
Jx.prototype.remove=function(p){var l=this,Q;return g.V(function(H){if(H.B==1)return g.S(H,GXt(l.token),2);Q=H.L;return g.S(H,Q.delete("prefs",p),0)})};
g.z(f0,g.Ps);g.z(gI,$CS);gI.prototype.X=function(p,l){l=qMY(l);p=(new TextEncoder).encode(JSON.stringify(p));return this.B.encrypt(p,l)};
gI.prototype.L=function(p,l){if(!(p instanceof Uint8Array))throw i1S(1);var Q=new TextDecoder;l=qMY(l);p=this.B.decrypt(p,l);return JSON.parse(Q.decode(p))};
var WR8={accountLinkStatusEntity:Y9o,booleanEntity:r6b,buttonEntity:fsb,captionTrack:Ydb,channelHandle:R08,commerceAcquisitionClientPayloadEntity:s4G,commerceCartListEntity:b6$,contextNoteFeedEntityPayload:F8t,continuationTokenEntity:L8C,downloadQualityPickerEntity:DO8,downloadsPageRefreshTokenEntity:Xao,downloadsPageViewConfigurationEntity:xOS,downloadStatusEntity:n08,dismissState:K2t,sfvAudioItemCurrentlyPlayingEntity:Vro,emojiFountainDataEntity:ArU,emojiCustomizationSetEntity:oWC,fakeChannel:jG$,
fakePlaylist:M_b,fakePlaylistEntryCollection:e0Y,fakeVideo:z08,fakeVideoDescription:ZbK,featuredProductsEntity:pLo,flowStateEntity:BBG,iconBadgeEntity:Pn5,interstitialInteractionStateEntity:a8C,likeButtonAnimationEntity:UOS,liveChatPollStateEntity:I8o,liveViewerLeaderboardChatEntryPointStateEntity:SdJ,liveViewerLeaderboardPointsEntity:Nko,liveReactionsDataEntity:Jrb,logoEntity:h0$,macroMarkerEntity:Ch5,mainDownloadsLibraryEntity:wao,mainDownloadsListEntity:NBK,mainPlaylistDownloadStateEntity:V_C,
mainPlaylistEntity:o0S,mainPlaylistVideoEntity:A6o,mainVideoDownloadStateEntity:kIG,mainVideoEntity:sGS,markersEngagementPanelSyncEntity:Ob5,markersVisibilityOverrideEntity:v05,musicAlbumReleaseDetail:trY,musicAlbumReleaseDownloadMetadataEntity:$xK,musicAlbumRelease:crK,musicAlbumReleaseUserDetail:EW$,musicArtistDetail:F2$,musicArtist:RAo,musicArtistUserDetail:rr$,musicDownloadsLibraryEntity:H6G,musicLibraryEdit:dx8,musicLibraryStatusEntity:j4$,musicPlaylist:Tkb,musicPlaylistDownloadMetadataEntity:qdY,
musicShare:eA$,musicTrackDetail:Z6o,musicTrackDownloadMetadataEntity:W2b,musicTrack:zAC,musicTrackUserDetail:Bkb,offlineOrchestrationActionWrapperEntity:hA8,offlineVideoPolicy:as$,offlineVideoStreams:IsJ,offlineabilityEntity:ucY,orchestrationWebSamplingEntity:K8b,pageHeaderEntity:yrK,pdpStateEntity:xxo,pinnedProductEntity:lsG,playbackData:Dxo,playerStateEntity:mOG,quantityIncrementerEntity:Uxo,refresh:nWC,saveToPlaylistListEntity:kX$,settingEntity:uat,stringEntity:dOo,suggestedFeedbackChipStateEntity:GIY,
transfer:XLo,trendingOfferEntity:Q4J,videoDownloadContextEntity:wLt,videoOverviewAsyncDataEntity:Cn8,videoPlaybackPositionEntity:gWG,votingEntity:L2Y,ytMainChannelEntity:bb$,youchatPendingResponseEntity:i6K,ytMainDownloadedVideoEntity:y6$,ytMainVideoEntity:Pho};g.z(C0,$CS);C0.prototype.X=function(p){return p};
C0.prototype.L=function(p){if(p instanceof Uint8Array)throw i1S(0);return p};
g.z(OV,g.L);OV.prototype.observe=function(p){var l=this;this.observers.push(p);return function(){var Q=l.observers.indexOf(p);Q>=0&&l.observers.splice(Q,1)}};
OV.prototype.L=function(p){BS5(this,p.data)};
OV.prototype.Xf=function(){this.channel.close()};
var DCK,YI5=new g.I8("elementsCommand");var Iw=new g.I8("entityBatchUpdate");var EY5=new g.I8("downloadStatusEntity");var DA5=new g.I8("mainPlaylistEntityActionMetadata");var vY=new g.I8("mainVideoEntityActionMetadata");var Kt8=new g.I8("musicPlaylistEntityActionMetadata");var Wmo=new g.I8("musicTrackEntityActionMetadata");var fpS=new g.I8("localImageEntityActionMetadata");var y8=new g.I8("playbackDataActionMetadata");var h3o=new g.I8("transferEntityActionMetadata");var c7J=new g.I8("videoPlaybackPositionEntityActionMetadata");var f_8;new g.h$;new g.h$;xC8.prototype.request=function(p,l,Q){l=l===void 0?{}:l;return this.locks.request(p,l,function(H){return Q(H)})};var $P=g.Jg.caches,Q8,mC8;lt.prototype.open=function(p){return $P.open(O1S(p))};
lt.prototype.has=function(p){return $P.has(O1S(p))};
lt.prototype.delete=function(p){return $P.delete(O1S(p))};
lt.prototype.match=function(p,l){var Q=this,H,q,W,c,E,R;return g.V(function(F){switch(F.B){case 1:return g.S(F,Q.keys(),2);case 2:H=F.L,q=g.Z(H),W=q.next();case 3:if(W.done){F.q3(5);break}c=W.value;return g.S(F,Q.open(c),6);case 6:return E=F.L,g.S(F,E.match(p,l),7);case 7:if(R=F.L)return F.return(R);W=q.next();F.q3(3);break;case 5:return F.return()}})};
g.z(CQY,lt);CQY.prototype.keys=function(){var p,l,Q,H,q,W,c,E,R;return g.V(function(F){if(F.B==1)return p=[],l=g.x$("CacheStorage keys"),g.S(F,$P.keys(),2);Q=F.L;H=g.Z(Q);for(q=H.next();!q.done;q=H.next()){W=q.value;var r=W.indexOf(":");c=r===-1?{m2:W}:{m2:W.substring(0,r),datasyncId:W.substring(r+1)};E=c.m2;R=c.datasyncId;R===l&&p.push(E)}return F.return(p)})};g.z(qs,g.L);qs.prototype.X=function(p){this.api.bO("onOfflineOperationFailure",p.data)};
qs.prototype.j=function(p){this.api.publish("offlinetransferpause",p.data)};
qs.prototype.Xf=function(){var p;(p=this.B)==null||p.close();var l;(l=this.L)==null||l.close()};puo.prototype.Br=function(){this.B&&cY(this)};
puo.prototype.p6=function(){this.L&&this.L.resolve();this.X=this.B=!1;this.Y()};var A78=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var zbJ="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var SI$="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.z(GJ8,kP);GJ8.prototype.L=function(p){return FG(p)?lWG(this,p):rm(p)?HCC(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.z(qat,kP);qat.prototype.L=function(p){return rm(p)?WPY(this,p):t8K(p)?tl5(this,p):dm(p)?E_t(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.t=R3U.prototype;g.t.fgL=function(p){var l=this,Q,H,q,W;return g.V(function(c){if(!g.U(p.state,128))return c.q3(0);Q=p.state.xF;var E=(H=Q)==null?void 0:H.errorCode,R=(q=Q)==null?void 0:q.I1;W=E==="net.connect"&&R===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(E==null?0:E.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.S(c,l.I2(l.player.getVideoData().videoId,W),0)})};
g.t.I2=function(p,l){var Q=this;return g.V(function(H){if(H.B==1){if(Q.L)return H.return();Q.L=!0;return l==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(AU(Q,p,!1,!0),H.q3(0)):g.S(H,ow(Q,p),3)}g.w3(p,4);return g.S(H,Q.B.I2(l),0)})};
g.t.Dl=function(p){p.status===2?(p.status!==this.X&&(W05(this.B),g.w3(p.videoId,2)),p.e9&&F0Y(this.B,p.videoId,p.e9)):p.status===4?(ow(this,p.videoId),this.I2(p.videoId,p.He?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):p.status===1&&RWJ(this.B);this.X=p.status;this.api.bO("localmediachange",{videoId:p.videoId,status:p.status})};
g.t.LI=function(){var p=this,l;return g.V(function(Q){if(Q.B==1){if(p.L)return Q.return();p.L=!0;l=p.player.getVideoData().videoId;return g.S(Q,ow(p,l),2)}return g.S(Q,p.B.LI(),0)})};
g.t.I$=function(p){switch(p){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.t.D=function(p){return this.api.U().D(p)};g.z(e3J,kP);e3J.prototype.L=function(p){return FG(p)?ZCb(this,p):rm(p)?BqJ(this,p):t8K(p)?Yat(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};Xeo.prototype.B=function(p,l){var Q=p.action.actionMetadata.priority-l.action.actionMetadata.priority;Q===0&&(p.B<l.B?Q=-1:p.B>l.B&&(Q=1));return Q};g.z(JU,g.L);JU.prototype.Xf=function(){this.Y&&this.Y();g.L.prototype.Xf.call(this)};
JU.prototype.createAction=function(p,l){var Q=g.Cu(p.entityKey).entityType,H=g.h3(16);return new zV(Q,H,p,l.actionId,l.rootActionId)};
JU.prototype.yQ=function(p){var l=this,Q,H,q,W,c,E,R,F,r;return g.V(function(d){if(d.B==1){if(l.vL())return d.return();H=(Q=p.offlineOrchestrationActionWrapperEntity)!=null?Q:new Set;q=[];W=g.Z(H);for(c=W.next();!c.done;c=W.next())E=c.value,R=g.Cu(E),F=R.entityId,NqY(l.B,F)||q.push(E);return g.S(d,g_K(l,q),2)}r=d.L;return g.S(d,fWY(l,r),0)})};
JU.prototype.retry=function(){var p=this;return g.V(function(l){return g.S(l,snY(p),0)})};P6o.prototype.zR=function(p,l){l=l===void 0?!0:l;var Q=this,H,q,W,c,E,R,F,r;return g.V(function(d){switch(d.B){case 1:if(!Q.B)return d.return();H=[];q=g.qI(Q.B.L,l);W=[];for(c={K$:0};c.K$<q.length;c={K$:c.K$},c.K$++)E=q[c.K$],R=Q.B.FZ(E,"json3"),F=g.wp(R,{withCredentials:!0,format:"RAW"},3,500).then(function(M){return function(T){T={metadata:g.d3(q[M.K$]),trackData:T.xhr.responseText};W.push(T)}}(c)).cF(function(M){HY("Caption fetch error",M)}),H.push(F);
return g.S(d,E0K(H),2);case 2:return g.Yl(d,3),g.S(d,ueY(p,W),5);case 5:g.ac(d,0);break;case 3:r=g.Ic(d),HY("Caption DB transaction error",r),g.Bi(d)}})};g.z(fc,g.L);fc.prototype.Xf=function(){this.L&&this.L();g.L.prototype.Xf.call(this)};
fc.prototype.X=function(p){var l=this,Q,H,q,W,c,E,R,F;return g.V(function(r){H=(Q=p.transfer)!=null?Q:new Set;q=[];W=g.Z(H);for(c=W.next();!c.done;c=W.next())E=c.value,R=g.Cu(E),F=R.entityId,q.push(F);return q.length===0?r.return():g.S(r,C6t(l,q),0)})};g.z(iSS,g.L);g.t=iSS.prototype;g.t.Xf=function(){this.uO&&this.uO();this.JP.dispose();this.j.dispose();this.ON&&g.C_(this.C.Dd,this.ON);this.QQ&&g.C_(this.C.Dd,this.QQ);g.L.prototype.Xf.call(this)};
g.t.Bjj=function(p){var l=this,Q,H,q;return g.V(function(W){switch(W.B){case 1:Q=g.OY(p,"transfer");if(l.B&&Q===l.B.key){AU(l.S,l.W,!0);l.j.stop();W.q3(0);break}return g.S(W,vR(l.L,{mode:"readwrite",Es:!0},function(c){return sV(c,Q,"transfer").then(function(E){if(E&&E.transferState!=="TRANSFER_STATE_COMPLETE"&&E.transferState!=="TRANSFER_STATE_FAILED")return E.transferState="TRANSFER_STATE_PAUSED_BY_USER",x8(c,E,"transfer").then(function(){return E})})}),3);
case 3:H=W.L;if(!H){W.q3(0);break}if(!p||!l.X){W.q3(5);break}return g.S(W,j4(p,l.X,l.L,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.S(W,bt(l,p),7);case 7:q=W.L,WtJ({videoId:p,tq:H,offlineModeType:q}),g.Bi(W)}})};
g.t.PMQ=function(){var p=this;if(this.B&&this.W){AU(this.S,this.W,!1);var l=this.B,Q=(l==null?0:l.key)?g.Cu(l.key).entityId:"";Q&&this.X&&(new Promise(function(H,q){j4(Q,p.X,p.L,"DOWNLOAD_STATE_PAUSED").catch(function(W){q(W)})})).catch(function(H){HY("Download state setting error",H)})}this.j.stop()};
g.t.jb=function(){this.B?QRY(this,this.B):s3(this)};
g.t.J7=function(p){var l=this;return g.V(function(Q){switch(Q.B){case 1:if(!l.B){Q.q3(2);break}if(l.B.transferState==="TRANSFER_STATE_COMPLETE"||l.B.transferState==="TRANSFER_STATE_FAILED"||!p.transfer||!p.transfer.has(l.B.key)){Q.q3(3);break}return g.S(Q,GB(l.L,l.B.key,"transfer"),4);case 4:l.B=Q.L;if(l.B){Q.q3(3);break}return g.S(Q,$AG(l),3);case 3:if(l.B)return Q.return();case 2:return g.S(Q,s3(l),0)}})};
g.t.I2=function(p,l){var Q=this,H,q,W,c,E;return g.V(function(R){switch(R.B){case 1:if(!Q.B){PY(Q,"onTransferFailure: "+p);R.q3(2);break}H=Q.B;W=((q=H)==null?0:q.key)?g.Cu(H.key).entityId:"";a:switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var F=!1;break a;default:F=!0}return F&&rmY(Q)?g.S(R,xP(Q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.S(R,
dAK(Q,p),5);case 5:if(!W||!Q.X){R.q3(2);break}return g.S(R,j4(W,Q.X,Q.L,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.S(R,bt(Q,W),9);case 9:c=R.L;E3({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:W,tq:H,offlineModeType:c});if(!W||!Q.X){R.q3(2);break}return g.S(R,j4(W,Q.X,Q.L,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:gm(Q),E=s3(Q,!0),l&&l(E),g.Bi(R)}})};
g.t.LI=function(p){var l=this,Q,H,q,W,c,E,R,F,r,d,M,T;return g.V(function(e){switch(e.B){case 1:if(!l.B){PY(l,"onMaybeTransferStreamsExpired");e.q3(2);break}return rmY(l)?g.S(e,xP(l,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.S(e,dAK(l,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!l.X){e.q3(2);break}Q=l.B;q=((H=Q)==null?0:H.key)?g.Cu(Q.key).entityId:"";if(!q){e.q3(2);break}return g.S(e,j4(q,l.X,l.L,"DOWNLOAD_STATE_FAILED"),2);case 9:return l.B||PY(l,"onMaybeTransferStreamsExpiredRetryAttempting"),
W=l.B,E=((c=W)==null?0:c.key)?g.Cu(W.key).entityId:"",g.S(e,bt(l,E),10);case 10:return R=e.L,E3({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:E,tq:W,offlineModeType:R}),F=rYJ(),g.Jc(F,y8,{isEnqueuedForExpiredStreamUrlRefetch:!0}),r=g.OY(E,"playbackData"),d={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:r,actionMetadata:F},M=BY(new zV("playbackData",E,d)),g.S(e,mY(l.L,M,"offlineOrchestrationActionWrapperEntity"),2);case 2:gm(l),T=s3(l,!0),
p&&p(T),g.Bi(e)}})};
var e_b={},jR$=(e_b.TRANSFER_STATE_TRANSFERRING=1,e_b.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,e_b);g.t=U3.prototype;g.t.Ut=function(){return this.W.promise};
g.t.yx=function(){if(this.L&&this.S)return this.W.promise;eWb(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.t.Gl=function(p){var l={};return l.playbackData=new GJ8(p,this.lO,this.B),l.transfer=new e3J(p,this.lO),l.videoPlaybackPositionEntity=new qat(p,this.lO),l};
g.t.sf=function(){var p=this;return g.V(function(l){return p.L?g.S(l,pFS(p.L),0):l.q3(0)})};
g.t.XD=function(){var p=this,l,Q;return g.V(function(H){if(H.B==1)return p.L||p.S?g.S(H,p.Ut(),2):H.return();p.T!==void 0&&(g.ea(p.T),p.T=void 0);p.j!==void 0&&(g.ea(p.j),p.j=void 0);(l=p.L)==null||l.dispose();p.L=void 0;(Q=p.S)==null||Q.dispose();p.S=void 0;p.api.bO("onOrchestrationLostLeader");p.W=new g.h$;g.Bi(H)})};
g.t.isOrchestrationLeader=function(){return this.X.B};
g.t.XL=function(){return g.V(function(p){return p.return(!1)})};
g.t.T7=function(p){var l=this.B;l.api.publish("offlinetransferpause",p);var Q;(Q=l.L)==null||Q.postMessage(p)};
g.t.jb=function(p){var l,Q;return g.V(function(H){if(H.B==1)return g.S(H,pc(),2);l=H.L;if(!l)return H.return();Q=g.OY(p,"transfer");return g.S(H,vR(l,{mode:"readwrite",Es:!0},function(q){var W=sV(q,Q,"transfer"),c=sV(q,g.OY(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Yd.all([W,c]).then(function(E){E=g.Z(E);var R=E.next().value;var F=E.next().value;return R&&R.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(R.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",x8(q,R,"transfer").then(function(){E3({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:p,tq:R,offlineModeType:F==null?void 0:F.offlineModeType});return g.Yd.resolve(null)})):g.Yd.resolve(null)})}),0)})};
g.t.yZ=function(p){p=p===void 0?43200:p;var l=this,Q,H,q,W,c,E,R,F;return g.V(function(r){if(r.B==1)return l.C.qp()?g.S(r,pc(),2):r.return(zW5());if(r.B!=3){Q=r.L;if(!Q)return r.return([]);H=Date.now()/1E3;return g.S(r,it(Q,"offlineVideoPolicy"),3)}q=r.L;W=[];c=g.Z(q);for(E=c.next();!E.done;E=c.next())R=E.value,Number(R.lastUpdatedTimestampSeconds)+p<=H&&(F=g.Cu(R.key).entityId,W.push(F));return W.length?r.return(Cc(l,W,l.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):r.return([])})};
g.t.deleteAll=function(){return Cc(this,["!*$_ALL_ENTITIES_!*$"],this.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.t.refreshAllStaleEntities=function(p){var l=this;return g.V(function(Q){return Q.B==1?g.S(Q,l.yZ(p),2):Q.return(Q.L)})};
g.t.setUpPositionSyncInterval=function(p){var l=this;this.j!==void 0&&(g.ea(this.j),this.j=void 0);var Q=p!=null?p:864E5;this.j=g.Mt(function(){l.Am(Q)},Q)};
g.t.Am=function(p){var l=this,Q,H,q,W,c,E;return g.V(function(R){switch(R.B){case 1:return g.Yl(R,2),g.S(R,Jx.getInstance(),4);case 4:Q=R.L;if(!Q)throw Error("prefStorage is undefined");return g.S(R,Q.get("psi"),5);case 5:H=R.L;W=((q=H)==null?0:q.LR)?Number(H.LR)/1E3:0;c=Date.now();if(!(W+p<=c)){R.q3(6);break}return g.S(R,Cc(l,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.ac(R,0);break;case 2:E=g.Ic(R),HY("Offline manager error",E),
g.Bi(R)}})};
g.t.W9=function(){var p=this,l,Q,H,q,W,c,E;return g.V(function(R){if(R.B==1)return g.S(R,pc(),2);if(R.B!=3)return(l=R.L)?g.S(R,it(l,"transfer"),3):R.return([]);Q=R.L;H=[];q=g.Z(Q);for(W=q.next();!W.done;W=q.next())c=W.value,c.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&c.key&&(E=g.Cu(c.key).entityId,H.push(E));return R.return(BM$(p,H))})};
g.t.pU=function(){return g.V(function(p){return p.return([])})};
g.t.LM=function(){return g.V(function(p){g.Bi(p)})};
g.t.qX=function(){return g.V(function(p){g.Bi(p)})};g.z(Y2o,kP);Y2o.prototype.L=function(p){return FG(p)?IpY(this,p):rm(p)?nvC(this,p):dm(p)?XFG(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var O3=[10];g.z(ku8,kP);ku8.prototype.L=function(p){return FG(p)?ym8(this,p):rm(p)?L0S(this,p):dm(p)?ovG(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var K0J=[10];g.z(Jm8,kP);Jm8.prototype.L=function(p){return rm(p)?gvb(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.z(sRt,U3);g.t=sRt.prototype;g.t.Gl=function(p){var l=U3.prototype.Gl.call(this,p);l.mainVideoEntity=new ku8(p,this.lO,this.B);l.mainPlaylistEntity=new Y2o(p,this.lO,this.B);l.mainDownloadsListEntity=new Jm8(p,this.lO,this.B);return l};
g.t.refreshAllStaleEntities=function(p,l){var Q=this,H,q,W,c,E,R,F,r,d,M,T;return g.V(function(e){switch(e.B){case 1:H=[];if(!Q.lO.D("web_player_offline_playlist_auto_refresh")){e.q3(2);break}return g.S(e,bSo(Q,p,l),3);case 3:H=e.L;case 2:return g.S(e,Jx.getInstance(),4);case 4:return q=e.L,g.S(e,(W=q)==null?void 0:W.get("sdois"),5);case 5:return c=e.L,g.S(e,(E=q)==null?void 0:E.get("lmqf"),6);case 6:R=e.L;if(!c){e.q3(7);break}r=H;d=r.concat;return g.S(e,PEG(Q,c,(F=R)!=null?F:"SD",p===0),8);case 8:H=
d.call(r,e.L);case 7:return M=H,T=M.concat,g.S(e,U3.prototype.refreshAllStaleEntities.call(Q,p,l),9);case 9:return H=T.call(M,e.L),e.return(H)}})};
g.t.XL=function(p){var l,Q,H,q,W,c,E,R;return g.V(function(F){if(F.B==1)return g.S(F,pc(),2);if(F.B!=3)return(l=F.L)?g.S(F,GB(l,g.VZ,"mainDownloadsListEntity"),3):F.return(!1);Q=F.L;if((H=Q)==null?0:(q=H.downloads)==null?0:q.length)for(W=g.OY(p,"mainVideoEntity"),c=g.Z(Q.downloads),E=c.next();!E.done;E=c.next())if(R=E.value,R.videoItem===W)return F.return(!0);return F.return(!1)})};
g.t.pU=function(){var p=this,l,Q,H,q,W,c,E,R;return g.V(function(F){if(F.B==1)return g.S(F,pc(),2);if(F.B!=3)return(l=F.L)?g.S(F,it(l,"downloadStatusEntity"),3):F.return([]);Q=F.L;H=[];q=g.Z(Q);for(W=q.next();!W.done;W=q.next())c=W.value,c.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&c.key&&(E=g.Cu(c.key).entityId,H.push(E));return H.length?(R={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},F.return(Cc(p,H,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
R))):F.return([])})};
g.t.qX=function(){var p;return g.V(function(l){return l.B==1?g.S(l,pc(),2):(p=l.L)?g.S(l,vR(p,{mode:"readwrite",Es:!0},function(Q){return bB(Q,"mainVideoEntity").then(function(H){var q=[];H=g.Z(H);for(var W=H.next();!W.done;W=H.next()){W=W.value;var c=void 0;(c=W.userState)!=null&&c.playbackPosition||(c=g.Cu(W.key).entityId,c={key:g.OY(c,"videoPlaybackPositionEntity"),videoId:c,lastPlaybackPositionSeconds:"0"},q.push(x8(Q,c,"videoPlaybackPositionEntity")),W.userState={playbackPosition:c.key},q.push(x8(Q,
W,"mainVideoEntity")))}return g.Yd.all(q)})}),0):l.return()})};
g.t.LM=function(){var p,l,Q,H,q,W,c,E,R,F,r,d,M,T,e,Y,a,D,X,N,u,J,iP,C,$l,Wi,G,b,m,B,P,fW,aY,M8,nW,i8,W$,et;return g.V(function(I){if(I.B==1)return g.S(I,pc(),2);if(I.B!=3){p=I.L;if(!p)return I.return();l=g.OY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.S(I,vR(p,{mode:"readonly",Es:!0},function(n){return g.Yd.all([sV(n,l,"mainDownloadsListEntity"),sV(n,g.VZ,"mainDownloadsListEntity"),bB(n,"mainVideoEntity"),bB(n,"mainPlaylistEntity")])}),3)}Q=I.L;
H=g.Z(Q);q=H.next().value;W=H.next().value;c=H.next().value;E=H.next().value;R=q;F=W;r=c;d=E;M=new Set;if((T=R)==null?0:(e=T.downloads)==null?0:e.length)for(Y=g.Z(R.downloads),a=Y.next();!a.done;a=Y.next())D=a.value,X=void 0,(N=(X=D.videoItem)!=null?X:D.playlistItem)&&M.add(N);if((u=F)==null?0:(J=u.downloads)==null?0:J.length)for(iP=g.Z(F.downloads),C=iP.next();!C.done;C=iP.next())$l=C.value,$l.videoItem&&M.add($l.videoItem);Wi=new Set;G=[];b=g.Z(d);for(m=b.next();!m.done;m=b.next()){B=m.value;if(B.videos)for(P=
g.Z(B.videos),fW=P.next();!fW.done;fW=P.next())aY=fW.value,(M8=JSON.parse(g.Cu(aY).entityId).videoId)&&Wi.add(M8);B.key&&!M.has(B.key)&&G.push(B.key)}nW=g.Z(r);for(i8=nW.next();!i8.done;i8=nW.next())W$=i8.value,W$.key&&!M.has(W$.key)&&(et=g.Cu(W$.key).entityId,Wi.has(et)||G.push(W$.key));return G.length?g.S(I,DE8(p,G),0):I.q3(0)})};g.z(xAS,kP);xAS.prototype.L=function(p){return FG(p)?CEY(this,p):rm(p)?OSb(this,p):dm(p)?vvS(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var mf=[10];g.z(Gu$,kP);Gu$.prototype.L=function(p){return FG(p)?pHJ(this,p):rm(p)?lgU(this,p):dm(p)?Q88(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var GV=[10];g.z(qpY,kP);qpY.prototype.L=function(p){return FG(p)?EN8(this,p):rm(p)?R_Y(this,p):dm(p)?Fmo(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var tNo=[10];g.z(iW,U3);iW.prototype.Gl=function(p){var l=U3.prototype.Gl.call(this,p);l.musicTrack=new qpY(p,this.B);l.musicPlaylist=new Gu$(p,this.B);l.musicAlbumRelease=new xAS(p,this.B);return l};
iW.prototype.refreshAllStaleEntities=function(p,l){var Q=this,H,q,W;return g.V(function(c){if(c.B==1)return g.S(c,dkG(Q,p,l),2);if(c.B!=3)return q=H=c.L,W=q.concat,g.S(c,U3.prototype.refreshAllStaleEntities.call(Q,p,l),3);H=W.call(q,c.L);return c.return(H)})};g.z(j8C,g.eH);g.t=j8C.prototype;g.t.create=function(){var p=this;g.A(this,this.events);g.CI(this.lO)?this.B=new sRt(this.lO,this.player):g.ym(this.lO)&&(this.B=new iW(this.lO,this.player));this.events.Z(this.player,"onPlaybackStartExternal",function(){p.c8()});
this.events.Z(this.player,"videodatachange",function(){p.c8()});
this.lO.D("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.jY)};
g.t.A4=function(){return!1};
g.t.wW=function(p,l,Q,H){var q=this;return g.V(function(W){return q.B?W.return(Cc(q.B,p,l,Q,H)):W.return(Promise.reject())})};
g.t.deleteAll=function(){return this.B.deleteAll()};
g.t.yZ=function(p){return this.B.yZ(p)};
g.t.refreshAllStaleEntities=function(p){return this.B.refreshAllStaleEntities(p)};
g.t.setUpPositionSyncInterval=function(p){this.B.setUpPositionSyncInterval(p)};
g.t.T7=function(p){this.B.T7(p)};
g.t.jb=function(p){return this.B.jb(p)};
g.t.c8=function(){var p=this,l;return g.V(function(Q){l=p.player.getVideoData();return g.bZ(l)?MN8(l)&&p.L!==l.clientPlaybackNonce?g.S(Q,TGK(p,l),0):Q.q3(0):Q.return()})};
g.t.jY=function(p){var l=this,Q,H,q,W,c,E,R;return g.V(function(F){if(F.B==1)return Q=l.player.getVideoData(),H=Q.ej,g.dh(p,2)||g.dh(p,512)?g.S(F,pc(),2):F.return();if(F.B!=3){q=F.L;if(!q)return HY("PES is undefined"),F.return();W=Q.videoId;return g.S(F,GB(q,g.OY(W,"mainVideoEntity"),"mainVideoEntity"),3)}c=F.L;if(!c)return F.return();E=Math.floor(H).toString();R={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:E}};return g.S(F,l.wW([W],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
R),0)})};
g.t.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.t.updateDownloadState=function(p,l){var Q,H,q,W;return g.V(function(c){if(c.B==1)return g.S(c,pc(),2);Q=c.L;if(!Q)return HY("PES is undefined"),c.return();H=g.Cu(p);q=H.entityType;W=H.entityId;return g.S(c,j4(W,q,Q,l,!0),0)})};g.T_("offline",j8C);})(_yt_player);
